/*
Copyright (c) 2017 NAVER Corp.
name: @egjs/view360
license: MIT
author: NAVER Corp.
repository: https://github.com/naver/egjs-view360
version: 3.5.2
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).eg=t.eg||{},t.eg.view360=e())}(this,function(){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function a(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var c=function(){return(c=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function i(t,s,a,h){return new(a=a||Promise)(function(i,e){function n(t){try{o(h.next(t))}catch(t){e(t)}}function r(t){try{o(h.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,r)}o((h=h.apply(t,s||[])).next())})}function o(i,n){var r,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(i,a)}catch(t){e=[6,t],o=0}finally{r=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function d(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)s.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}(arguments[e]));return t}function l(t){return void 0===t}var t=function(){function t(){this.options={},this._eventHandler={}}var e=t.prototype;return e.trigger=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(!(0<(s=this._eventHandler[t]||[]).length))return!0;var r=i[0]||{},o=i.slice(1),s=s.concat(),a=!1;r.eventType=t,r.stop=function(){a=!0},r.currentTarget=this;var h=[r];return 1<=o.length&&(h=h.concat(o)),s.forEach(function(t){t.apply(e,h)}),!a},e.once=function(i,n){var r,o=this;if("object"==typeof i&&l(n)){var t,e=i;for(t in e)this.once(t,e[t]);return this}return"string"==typeof i&&"function"==typeof n&&(r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.apply(o,t),o.off(i,r)},this.on(i,r)),this},e.hasOn=function(t){return!!this._eventHandler[t]},e.on=function(t,e){if("object"==typeof t&&l(e)){var i,n=t;for(i in n)this.on(i,n[i]);return this}var r;return"string"==typeof t&&"function"==typeof e&&(l(r=this._eventHandler[t])&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(e)),this},e.off=function(t,e){var i,n;if(l(t))return this._eventHandler={},this;if(l(e)){if("string"==typeof t)return delete this._eventHandler[t],this;var r,o=t;for(r in o)this.off(r,o[r]);return this}var s=this._eventHandler[t];if(s){var a=0;try{for(var h=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),u=h.next();!u.done;u=h.next()){if(u.value===e){s.splice(a,1);break}a++}}catch(t){i={error:t}}finally{try{u&&!u.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}return this},t.VERSION="2.2.2",t}();var e=setTimeout;function h(t){return Boolean(t&&void 0!==t.length)}function r(){}function u(t){if(!(this instanceof u))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],_(t,this)}function s(i,n){for(;3===i._state;)i=i._value;0!==i._state?(i._handled=!0,u._immediateFn(function(){var t,e=1===i._state?n.onFulfilled:n.onRejected;if(null!==e){try{t=e(i._value)}catch(t){return void m(n.promise,t)}p(n.promise,t)}else(1===i._state?p:m)(n.promise,i._value)})):i._deferreds.push(n)}function p(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof u)return e._state=3,e._value=t,void v(e);if("function"==typeof i)return void _((n=i,r=t,function(){n.apply(r,arguments)}),e)}e._state=1,e._value=t,v(e)}catch(t){m(e,t)}var n,r}function m(t,e){t._state=2,t._value=e,v(t)}function v(t){2===t._state&&0===t._deferreds.length&&u._immediateFn(function(){t._handled||u._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)s(t,t._deferreds[e]);t._deferreds=null}function g(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function _(t,e){var i=!1;try{t(function(t){i||(i=!0,p(e,t))},function(t){i||(i=!0,m(e,t))})}catch(t){if(i)return;i=!0,m(e,t)}}function y(t,e){for(var i=t.length,n=0;n<i;++n)if(e(t[n],n))return!0;return!1}function x(t,e){for(var i=t.length,n=0;n<i;++n)if(e(t[n],n))return t[n];return null}function w(t,e){try{return new RegExp(t,"g").exec(e)}catch(t){return null}}function E(t){return t.replace(/_/g,".")}function T(t,i){var n=null,r="-1";return y(t,function(t){var e=w("("+t.test+")((?:\\/|\\s|:)([0-9|\\.|_]+))?",i);return e&&!t.brand&&(n=t,r=e[3]||"-1",t.versionAlias?r=t.versionAlias:t.versionTest&&(t=t.versionTest.toLowerCase(),r=((t=w("("+t+")((?:\\/|\\s|:)([0-9|\\.|_]+))?",t=i))?t[3]:"")||r),r=E(r),1)}),{preset:n,version:r}}function R(t,e){return x(t,function(t){t=t.brand;return w(""+e.test,t.toLowerCase())})}u.prototype.catch=function(t){return this.then(null,t)},u.prototype.then=function(t,e){var i=new this.constructor(r);return s(this,new g(t,e,i)),i},u.prototype.finally=function(e){var i=this.constructor;return this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){return i.reject(t)})})},u.all=function(e){return new u(function(r,o){if(!h(e))return o(new TypeError("Promise.all accepts an array"));var s=Array.prototype.slice.call(e);if(0===s.length)return r([]);var a=s.length;for(var t=0;t<s.length;t++)!function e(i,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){e(i,t)},o)}s[i]=t,0==--a&&r(s)}catch(t){o(t)}}(t,s[t])})},u.allSettled=function(i){return new this(function(r,t){if(!i||void 0===i.length)return t(new TypeError(typeof i+" "+i+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var o=Array.prototype.slice.call(i);if(0===o.length)return r([]);var s=o.length;for(var e=0;e<o.length;e++)!function e(i,t){if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){e(i,t)},function(t){o[i]={status:"rejected",reason:t},0==--s&&r(o)})}o[i]={status:"fulfilled",value:t},0==--s&&r(o)}(e,o[e])})},u.resolve=function(e){return e&&"object"==typeof e&&e.constructor===u?e:new u(function(t){t(e)})},u.reject=function(i){return new u(function(t,e){e(i)})},u.race=function(r){return new u(function(t,e){if(!h(r))return e(new TypeError("Promise.race accepts an array"));for(var i=0,n=r.length;i<n;i++)u.resolve(r[i]).then(t,e)})},u._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){e(t,0)},u._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var b=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],C=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",brand:!0}],P=[{test:"applewebkit",id:"webkit"}],I=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],A=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"mac os x",id:"mac"},{test:"android",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function S(t){var e=function(t){if(void 0===t){if("undefined"==typeof navigator||!navigator)return"";t=navigator.userAgent||""}return t.toLowerCase()}(t),i=!!/mobi/g.exec(e),n={name:"unknown",version:"-1",majorVersion:-1,webview:!!T(I,e).preset,chromium:!!T(C,e).preset,webkit:!1},r={name:"unknown",version:"-1",majorVersion:-1},o=T(b,e),s=o.preset,a=o.version,t=T(A,e),o=t.preset,t=t.version;return n.webkit=!n.chromium&&!!T(P,e).preset,o&&(r.name=o.id,r.version=t,r.majorVersion=parseInt(t,10)),s&&(n.name=s.id,n.version=a,n.webview&&"ios"===r.name&&"safari"!==n.name&&(n.webview=!1)),n.majorVersion=parseInt(n.version,10),{browser:n,os:r,isMobile:i,isHints:!1}}function O(t){return void 0===t&&function(){if("undefined"!=typeof navigator&&navigator&&navigator.userAgentData){var t=navigator.userAgentData,t=t.brands||t.uaList;return t&&t.length}}()?(n=((a=navigator.userAgentData).uaList||a.brands).slice(),r=a.mobile||!1,o=n[0],s={name:o.brand,version:o.version,majorVersion:-1,webkit:!1,webview:y(I,function(t){return R(n,t)}),chromium:y(C,function(t){return R(n,t)})},a={name:"unknown",version:"-1",majorVersion:-1},s.webkit=!s.chromium&&y(P,function(t){return R(n,t)}),i&&(e=i.platform.toLowerCase(),o=x(A,function(t){return new RegExp(""+t.test,"g").exec(e)}),a.name=o?o.id:e,a.version=i.platformVersion),y(b,function(t){var e=R(n,t);return e&&(s.name=t.id,s.version=i?i.uaFullVersion:e.version,1)}),"Linux armv8l"===navigator.platform?a.name="android":s.webkit&&(a.name=r?"ios":"mac"),"ios"===a.name&&s.webview&&(s.version="-1"),a.version=E(a.version),s.version=E(s.version),a.majorVersion=parseInt(a.version,10),s.majorVersion=parseInt(s.version,10),{browser:s,os:a,isMobile:r,isHints:!0}):S(t);var i,e,n,r,o,s,a}var M="undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),D=M.document,F=M.navigator,L=O(),V=L.os.name,N=L.browser.name,k="ios"===V,U="mac"===V&&"safari"===N;M.Float32Array=void 0!==M.Float32Array?M.Float32Array:M.Array;M.Float32Array,M.getComputedStyle;var z=M.navigator&&M.navigator.userAgent,Q="ontouchstart"in M,X="ondevicemotion"in M,W=M.DeviceMotionEvent,B=M.devicePixelRatio,Y=function(){for(var t,e=null!==(t=null==D?void 0:D.documentElement.style)&&void 0!==t?t:{},i=["transform","webkitTransform","msTransform","mozTransform"],n=0,r=i.length;n<r;n++)if(i[n]in e)return i[n];return""}(),G=M.CSS&&M.CSS.supports&&M.CSS.supports("will-change","transform"),j=!1,H=function(){var t=window.navigator;t.xr&&(t.xr.isSessionSupported?t.xr.isSessionSupported("immersive-vr").then(function(t){j=t}).catch(function(){}):t.xr.supportsSession&&t.xr.supportsSession("immersive-vr").then(function(t){j=t}).catch(function(){}))};function q(){return(q=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,n=arguments[e];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function K(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function Z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var J,$="function"!=typeof Object.assign?function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}:Object.assign,tt=["","webkit","Moz","MS","ms","o"],et="undefined"==typeof document?{style:{}}:document.createElement("div"),it="function",nt=Math.round,rt=Math.abs,ot=Date.now;function st(t,e){for(var i,n=e[0].toUpperCase()+e.slice(1),r=0;r<tt.length;){if((i=(i=tt[r])?i+n:e)in t)return i;r++}}J="undefined"==typeof window?{}:window;var at=st(et.style,"touchAction"),ht=void 0!==at;var ut="compute",ct="manipulation",lt="none",dt="pan-x",ft="pan-y",pt=function(){if(!ht)return!1;var e={},i=J.CSS&&J.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(t){return e[t]=!i||J.CSS.supports("touch-action",t)}),e}(),mt="ontouchstart"in J,vt=void 0!==st(J,"PointerEvent"),gt=mt&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),_t="touch",yt="mouse",xt=25,wt=1,Et=4,Tt=8,Rt=1,bt=2,Ct=4,Pt=8,It=16,At=bt|Ct,St=Pt|It,Ot=At|St,Mt=["x","y"],Dt=["clientX","clientY"];function Ft(t,e,i){if(t)if(t.forEach)t.forEach(e,i);else if(void 0!==t.length)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(var n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function Lt(t,e){return typeof t===it?t.apply(e&&e[0]||void 0,e):t}function Vt(t,e){return-1<t.indexOf(e)}var Nt=function(){function t(t,e){this.manager=t,this.set(e)}var e=t.prototype;return e.set=function(t){t===ut&&(t=this.compute()),ht&&this.manager.element.style&&pt[t]&&(this.manager.element.style[at]=t),this.actions=t.toLowerCase().trim()},e.update=function(){this.set(this.manager.options.touchAction)},e.compute=function(){var e=[];return Ft(this.manager.recognizers,function(t){Lt(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(t){if(Vt(t,lt))return lt;var e=Vt(t,dt),i=Vt(t,ft);return e&&i?lt:e||i?e?dt:ft:Vt(t,ct)?ct:"auto"}(e.join(" "))},e.preventDefaults=function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,r=Vt(n,lt)&&!pt[lt],o=Vt(n,ft)&&!pt[ft],s=Vt(n,dt)&&!pt[dt];if(r){var a=1===t.pointers.length,n=t.distance<2,t=t.deltaTime<250;if(a&&n&&t)return}if(!s||!o)return r||o&&i&At||s&&i&St?this.preventSrc(e):void 0}},e.preventSrc=function(t){this.manager.session.prevented=!0,t.preventDefault()},t}();function kt(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function Ut(t){var e=t.length;if(1===e)return{x:nt(t[0].clientX),y:nt(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:nt(i/e),y:nt(n/e)}}function zt(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:nt(t.pointers[i].clientX),clientY:nt(t.pointers[i].clientY)},i++;return{timeStamp:ot(),pointers:e,center:Ut(e),deltaX:t.deltaX,deltaY:t.deltaY}}function Qt(t,e,i){var n=e[(i=i||Mt)[0]]-t[i[0]],i=e[i[1]]-t[i[1]];return Math.sqrt(n*n+i*i)}function Xt(t,e,i){var n=e[(i=i||Mt)[0]]-t[i[0]],i=e[i[1]]-t[i[1]];return 180*Math.atan2(i,n)/Math.PI}function Wt(t,e){return t===e?Rt:rt(t)>=rt(e)?t<0?bt:Ct:e<0?Pt:It}function Bt(t,e,i){return{x:e/t||0,y:i/t||0}}function Yt(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=zt(e)),1<r&&!i.firstMultiple?i.firstMultiple=zt(e):1===r&&(i.firstMultiple=!1);var o,s,a=i.firstInput,h=i.firstMultiple,u=(h||a).center,c=e.center=Ut(n);e.timeStamp=ot(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=Xt(u,c),e.distance=Qt(u,c),o=i,r=(s=e).center,a=o.offsetDelta||{},u=o.prevDelta||{},c=o.prevInput||{},s.eventType!==wt&&c.eventType!==Et||(u=o.prevDelta={x:c.deltaX||0,y:c.deltaY||0},a=o.offsetDelta={x:r.x,y:r.y}),s.deltaX=u.x+(r.x-a.x),s.deltaY=u.y+(r.y-a.y),e.offsetDirection=Wt(e.deltaX,e.deltaY);var l,d,f,p,m,r=Bt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=r.x,e.overallVelocityY=r.y,e.overallVelocity=rt(r.x)>rt(r.y)?r.x:r.y,e.scale=h?(a=h.pointers,Qt((r=n)[0],r[1],Dt)/Qt(a[0],a[1],Dt)):1,e.rotation=h?(m=h.pointers,Xt((l=n)[1],l[0],Dt)+Xt(m[1],m[0],Dt)):0,e.maxPointers=!i.prevInput||e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers,n=e,m=(l=i).lastInterval||n,i=n.timeStamp-m.timeStamp,n.eventType!==Tt&&(xt<i||void 0===m.velocity)?(d=(p=Bt(i,i=n.deltaX-m.deltaX,v=n.deltaY-m.deltaY)).x,f=p.y,p=rt(p.x)>rt(p.y)?p.x:p.y,v=Wt(i,v),l.lastInterval=n):(p=m.velocity,d=m.velocityX,f=m.velocityY,v=m.direction),n.velocity=p,n.velocityX=d,n.velocityY=f,n.direction=v;var v=t.element,t=e.srcEvent,t=t.composedPath?t.composedPath()[0]:t.path?t.path[0]:t.target;kt(t,v)&&(v=t),e.target=v}function Gt(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,o=e&wt&&n-r==0,r=e&(Et|Tt)&&n-r==0;i.isFirst=!!o,i.isFinal=!!r,o&&(t.session={}),i.eventType=e,Yt(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function jt(t){return t.trim().split(/\s+/g)}function Ht(e,t,i){Ft(jt(t),function(t){e.addEventListener(t,i,!1)})}function qt(e,t,i){Ft(jt(t),function(t){e.removeEventListener(t,i,!1)})}function Kt(t){t=t.ownerDocument||t;return t.defaultView||t.parentWindow||window}var Zt=function(){function t(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){Lt(e.options.enable,[e])&&i.handler(t)},this.init()}var e=t.prototype;return e.handler=function(){},e.init=function(){this.evEl&&Ht(this.element,this.evEl,this.domHandler),this.evTarget&&Ht(this.target,this.evTarget,this.domHandler),this.evWin&&Ht(Kt(this.element),this.evWin,this.domHandler)},e.destroy=function(){this.evEl&&qt(this.element,this.evEl,this.domHandler),this.evTarget&&qt(this.target,this.evTarget,this.domHandler),this.evWin&&qt(Kt(this.element),this.evWin,this.domHandler)},t}();function Jt(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}var $t={pointerdown:wt,pointermove:2,pointerup:Et,pointercancel:Tt,pointerout:Tt},te={2:_t,3:"pen",4:yt,5:"kinect"},ee="pointerdown",ie="pointermove pointerup pointercancel";J.MSPointerEvent&&!J.PointerEvent&&(ee="MSPointerDown",ie="MSPointerMove MSPointerUp MSPointerCancel");var ne=function(e){function i(){var t=i.prototype;return t.evEl=ee,t.evWin=ie,(t=e.apply(this,arguments)||this).store=t.manager.session.pointerEvents=[],t}return K(i,e),i.prototype.handler=function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=$t[n],o=te[t.pointerType]||t.pointerType,s=o===_t,n=Jt(e,t.pointerId,"pointerId");r&wt&&(0===t.button||s)?n<0&&(e.push(t),n=e.length-1):r&(Et|Tt)&&(i=!0),n<0||(e[n]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),i&&e.splice(n,1))},i}(Zt);function re(t){return Array.prototype.slice.call(t,0)}var oe={touchstart:wt,touchmove:2,touchend:Et,touchcancel:Tt},se="touchstart touchmove touchend touchcancel",ae=function(e){function i(){var t;return i.prototype.evTarget=se,(t=e.apply(this,arguments)||this).targetIds={},t}return K(i,e),i.prototype.handler=function(t){var e=oe[t.type],i=function(t,e){var i,n,r=re(t.touches),o=this.targetIds;if(e&(2|wt)&&1===r.length)return o[r[0].identifier]=!0,[r,r];var s=re(t.changedTouches),a=[],h=this.target;if(n=r.filter(function(t){return kt(t.target,h)}),e===wt)for(i=0;i<n.length;)o[n[i].identifier]=!0,i++;i=0;for(;i<s.length;)o[s[i].identifier]&&a.push(s[i]),e&(Et|Tt)&&delete o[s[i].identifier],i++;return a.length?[function(t,i,e){for(var n=[],r=[],o=0;o<t.length;){var s=i?t[o][i]:t[o];Jt(r,s)<0&&n.push(t[o]),r[o]=s,o++}return e&&(n=i?n.sort(function(t,e){return t[i]>e[i]}):n.sort()),n}(n.concat(a),"identifier",!0),a]:void 0}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:_t,srcEvent:t})},i}(Zt);var he={mousedown:wt,mousemove:2,mouseup:Et},ue="mousedown",ce="mousemove mouseup",le=function(e){function i(){var t=i.prototype;return t.evEl=ue,t.evWin=ce,(t=e.apply(this,arguments)||this).pressed=!1,t}return K(i,e),i.prototype.handler=function(t){var e=he[t.type];e&wt&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=Et),this.pressed&&(e&Et&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:yt,srcEvent:t}))},i}(Zt),de=2500,fe=25;function pe(t){var e,i,t=t.changedPointers[0];t.identifier===this.primaryTouch&&(e={x:t.clientX,y:t.clientY},i=this.lastTouches,this.lastTouches.push(e),setTimeout(function(){var t=i.indexOf(e);-1<t&&i.splice(t,1)},de))}var me=function(){return function(i){function t(t,e){var o=i.call(this,t,e)||this;return o.handler=function(t,e,i){var n=i.pointerType===_t,r=i.pointerType===yt;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(t,e){t&wt?(this.primaryTouch=e.changedPointers[0].identifier,pe.call(this,e)):t&(Et|Tt)&&pe.call(this,e)}).call(Z(Z(o)),e,i);else if(r&&function(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],o=Math.abs(e-r.x),r=Math.abs(i-r.y);if(o<=fe&&r<=fe)return!0}return!1}.call(Z(Z(o)),i))return;o.callback(t,e,i)}},o.touch=new ae(o.manager,o.handler),o.mouse=new le(o.manager,o.handler),o.primaryTouch=null,o.lastTouches=[],o}return K(t,i),t.prototype.destroy=function(){this.touch.destroy(),this.mouse.destroy()},t}(Zt)}();function ve(t,e,i){return Array.isArray(t)&&(Ft(t,i[e],i),1)}var ge=1;function _e(t,e){e=e.manager;return e?e.get(t):t}function ye(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}var xe=function(){function t(t){void 0===t&&(t={}),this.options=q({enable:!0},t),this.id=ge++,this.manager=null,this.state=1,this.simultaneous={},this.requireFail=[]}var e=t.prototype;return e.set=function(t){return $(this.options,t),this.manager&&this.manager.touchAction.update(),this},e.recognizeWith=function(t){if(ve(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=_e(t,this)).id]||(e[t.id]=t).recognizeWith(this),this},e.dropRecognizeWith=function(t){return ve(t,"dropRecognizeWith",this)||(t=_e(t,this),delete this.simultaneous[t.id]),this},e.requireFailure=function(t){if(ve(t,"requireFailure",this))return this;var e=this.requireFail;return-1===Jt(e,t=_e(t,this))&&(e.push(t),t.requireFailure(this)),this},e.dropRequireFailure=function(t){if(ve(t,"dropRequireFailure",this))return this;t=_e(t,this);t=Jt(this.requireFail,t);return-1<t&&this.requireFail.splice(t,1),this},e.hasRequireFailures=function(){return 0<this.requireFail.length},e.canRecognizeWith=function(t){return!!this.simultaneous[t.id]},e.emit=function(e){var i=this,t=this.state;function n(t){i.manager.emit(t,e)}t<8&&n(i.options.event+ye(t)),n(i.options.event),e.additionalEvent&&n(e.additionalEvent),8<=t&&n(i.options.event+ye(t))},e.tryEmit=function(t){if(this.canEmit())return this.emit(t);this.state=32},e.canEmit=function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},e.recognize=function(t){t=$({},t);if(!Lt(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},e.process=function(){},e.getTouchAction=function(){},e.reset=function(){},t}(),we=function(e){function t(t){return void 0===t&&(t={}),e.call(this,q({pointers:1},t))||this}K(t,e);var i=t.prototype;return i.attrTest=function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},i.process=function(t){var e=this.state,i=t.eventType,n=6&e,t=this.attrTest(t);return n&&(i&Tt||!t)?16|e:n||t?i&Et?8|e:2&e?4|e:2:32},t}(xe);var Ee=function(i){function t(t){return void 0===t&&(t={}),(t=i.call(this,q({event:"pan",threshold:10,pointers:1,direction:Ot},t))||this).pX=null,t.pY=null,t}K(t,i);var e=t.prototype;return e.getTouchAction=function(){var t=this.options.direction,e=[];return t&At&&e.push(ft),t&St&&e.push(dt),e},e.directionTest=function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(n=e.direction&At?(r=0===o?Rt:o<0?bt:Ct,i=o!==this.pX,Math.abs(t.deltaX)):(r=0===s?Rt:s<0?Pt:It,i=s!==this.pY,Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},e.attrTest=function(t){return we.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},e.emit=function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e,e=(e=t.direction)===It?"down":e===Pt?"up":e===bt?"left":e===Ct?"right":"";e&&(t.additionalEvent=this.options.event+e),i.prototype.emit.call(this,t)},t}(we),Te=function(i){function t(t){return void 0===t&&(t={}),i.call(this,q({event:"pinch",threshold:0,pointers:2},t))||this}K(t,i);var e=t.prototype;return e.getTouchAction=function(){return[lt]},e.attrTest=function(t){return i.prototype.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},e.emit=function(t){var e;1!==t.scale&&(e=t.scale<1?"in":"out",t.additionalEvent=this.options.event+e),i.prototype.emit.call(this,t)},t}(we),Re={domEvents:!1,touchAction:ut,enable:!0,inputTarget:null,inputClass:null,cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function be(i,n){var r,o=i.element;o.style&&(Ft(i.options.cssProps,function(t,e){r=st(o.style,e),n?(i.oldCssProps[r]=o.style[r],o.style[r]=t):o.style[r]=i.oldCssProps[r]||""}),n||(i.oldCssProps={}))}var Ce=function(){function t(t,e){var i=this;this.options=$({},Re,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((t=this).options.inputClass||(vt?ne:gt?ae:mt?me:le))(t,Gt),this.touchAction=new Nt(this,this.options.touchAction),be(this,!0),Ft(this.options.recognizers,function(t){var e=i.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}var e=t.prototype;return e.set=function(t){return $(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},e.stop=function(t){this.session.stopped=t?2:1},e.recognize=function(t){var e,i=this.session;if(!i.stopped){this.touchAction.preventDefaults(t);var n=this.recognizers,r=i.curRecognizer;(!r||r&&8&r.state)&&(r=i.curRecognizer=null);for(var o=0;o<n.length;)e=n[o],2===i.stopped||r&&e!==r&&!e.canRecognizeWith(r)?e.reset():e.recognize(t),!r&&14&e.state&&(r=i.curRecognizer=e),o++}},e.get=function(t){if(t instanceof xe)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event===t)return e[i];return null},e.add=function(t){if(ve(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),(t.manager=this).touchAction.update(),t},e.remove=function(t){if(ve(t,"remove",this))return this;var e=this.get(t);return!t||-1!==(e=Jt(t=this.recognizers,e))&&(t.splice(e,1),this.touchAction.update()),this},e.on=function(t,e){if(void 0===t||void 0===e)return this;var i=this.handlers;return Ft(jt(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},e.off=function(t,e){if(void 0===t)return this;var i=this.handlers;return Ft(jt(t),function(t){e?i[t]&&i[t].splice(Jt(i[t],e),1):delete i[t]}),this},e.emit=function(t,e){var i,n,r;this.options.domEvents&&(i=t,n=e,(r=document.createEvent("Event")).initEvent(i,!0,!0),(r.gesture=n).target.dispatchEvent(r));var o=this.handlers[t]&&this.handlers[t].slice();if(o&&o.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var s=0;s<o.length;)o[s](e),s++}},e.destroy=function(){this.element&&be(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null},t}(),Pe=function(t,e){return(Pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var Ie,Ae=function(){return(Ae=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function Se(t,e,i,n){e=[!i[0]&&n?e[0]-n[0]:e[0],!i[1]&&n?e[1]+n[1]:e[1]],t=Math.max(e[0],t);return t=Math.min(e[1],t)}function Oe(t,e){return t<e[0]||t>e[1]}function Me(t,e,i){return i[1]&&t>e[1]||i[0]&&t<e[0]}function De(t,e,i){var n=t,r=e[0],o=e[1],e=o-r;return i[1]&&o<t&&(n=(n-o)%e+r),i[0]&&t<r&&(n=(n-r)%e+o),n}function Fe(t){for(var e=[],i=0,n=t.length;i<n;i++)e.push(t[i]);return e}function Le(t,e){var i;return void 0===e&&(e=!1),"string"==typeof t?(i=t.match(/^<([a-z]+)\s*([^>]*)>/)?((i=document.createElement("div")).innerHTML=t,Fe(i.childNodes)):Fe(document.querySelectorAll(t)),e||(i=1<=i.length?i[0]:void 0)):t!==Ie&&(!t.nodeName||1!==t.nodeType&&9!==t.nodeType)?"jQuery"in Ie&&t instanceof jQuery||t.constructor.prototype.jquery?i=e?t.toArray():t.get(0):Array.isArray(t)&&(i=t.map(function(t){return Le(t)}),e||(i=1<=i.length?i[0]:void 0)):i=t,i}var Ve,Ne,ke=(Ie="undefined"==typeof window?{navigator:{userAgent:""}}:window).requestAnimationFrame||Ie.webkitRequestAnimationFrame,Ue=Ie.cancelAnimationFrame||Ie.webkitCancelAnimationFrame;function ze(t,e){var i,n={};for(i in t)i&&(n[i]=e(t[i],i));return n}function Qe(t,e){var i,n={};for(i in t)i&&e(t[i],i)&&(n[i]=t[i]);return n}function Xe(t,e){for(var i in t)if(i&&!e(t[i],i))return!1;return!0}function We(t,i){return Xe(t,function(t,e){return t===i[e]})}ke&&!Ue?(Ve={},Ne=ke,ke=function(e){var i=Ne(function(t){Ve[i]&&e(t)});return Ve[i]=!0,i},Ue=function(t){delete Ve[t]}):ke&&Ue||(ke=function(t){return Ie.setTimeout(function(){t(Ie.performance&&Ie.performance.now&&Ie.performance.now()||(new Date).getTime())},16)},Ue=Ie.clearTimeout);var Be={};function Ye(t,e){var i,n;return Be[e]||(Be[e]=(n=(i=e)<1?Math.pow(10,je(i)):1,function(t){return 0===i?0:Math.round(Math.round(t/i)*i*n)/n})),Be[e](t)}function Ge(t,i){if(!t||!i)return t;var n="number"==typeof i;return ze(t,function(t,e){return Ye(t,n?i:i[e])})}function je(t){if(!isFinite(t))return 0;var e=t+"";if(0<=e.indexOf("e")){for(var i=0,n=1;Math.round(t*n)/n!==t;)n*=10,i++;return i}return 0<=e.indexOf(".")?e.length-e.indexOf(".")-1:0}function He(t,e,i){return Math.max(Math.min(t,i),e)}var qe=function(){function t(t){var e=t.options,i=t.itm,n=t.em,t=t.axm;this.options=e,this.itm=i,this.em=n,this.axm=t,this.animationEnd=this.animationEnd.bind(this)}var e=t.prototype;return e.getDuration=function(i,t,e){var n,r=this;return He(void 0!==e?e:(n=ze(t,function(t,e){return t=Math.abs(t-i[e]),e=r.options.deceleration,(e=Math.sqrt(t/e*2))<100?0:e}),Object.keys(n).reduce(function(t,e){return Math.max(t,n[e])},-1/0)),this.options.minimumDuration,this.options.maximumDuration)},e.createAnimationParam=function(t,e,i){var n=this.axm.get(),r=t,t=i&&i.event||null;return{depaPos:n,destPos:r,duration:He(e,this.options.minimumDuration,this.options.maximumDuration),delta:this.axm.getDelta(n,r),inputEvent:t,input:i&&i.input||null,isTrusted:!!t,done:this.animationEnd}},e.grab=function(t,e){var i;this._animateParam&&t.length&&(i=this.axm.get(t),Xe(t=this.axm.map(i,function(t,e){return De(t,e.range,e.circular)}),function(t,e){return i[e]===t})||this.em.triggerChange(t,!1,i,e,!!e),this._animateParam=null,this._raf&&(t=this._raf,Ue(t)),this._raf=null,this.em.triggerAnimationEnd(!(!e||!e.event)))},e.getEventInfo=function(){return this._animateParam&&this._animateParam.input&&this._animateParam.inputEvent?{input:this._animateParam.input,event:this._animateParam.inputEvent}:null},e.restore=function(t){var e=this.axm.get(),i=this.axm.map(e,function(t,e){return Math.min(e.range[1],Math.max(e.range[0],t))});this.animateTo(i,this.getDuration(e,i),t)},e.animationEnd=function(){var t=this.getEventInfo();this._animateParam=null;var e=this.axm.filter(this.axm.get(),function(t,e){return Me(t,e.range,e.circular)});0<Object.keys(e).length&&this.setTo(this.axm.map(e,function(t,e){return De(t,e.range,e.circular)})),this.itm.setInterrupt(!1),this.em.triggerAnimationEnd(!!t),this.axm.isOutside()?this.restore(t):this.finish(!!t)},e.finish=function(t){this._animateParam=null,this.itm.setInterrupt(!1),this.em.triggerFinish(t)},e.animateLoop=function(s,a){var h,u,c,l,d,f,p,m;s.duration?(this._animateParam=Ae({},s),h=this._animateParam,u=this,c=h.destPos,l=h.depaPos,d=0,f=ze(l,function(t,e){return t<=c[e]?1:-1}),p=ze(c,function(t){return t}),m=(new Date).getTime(),h.startTime=m,function t(){u._raf=null;var e=(new Date).getTime(),r=(e-h.startTime)/s.duration,o=u.easing(r),i=u.axm.map(l,function(t,e,i){var n=1<=r?c[i]:t+h.delta[i]*(o-d),t=De(n,e.range,e.circular);return n!==t&&(e=f[i]*(e.range[1]-e.range[0]),c[i]-=e,l[i]-=e),t}),n=!u.em.triggerChange(i,!1,l);l=i,m=e,1<=(d=o)?(We(c=u.getFinalPos(c,p),u.axm.get(Object.keys(c)))||u.em.triggerChange(c,!0,l),a()):n?u.finish(!1):u._raf=ke(t)}()):(this.em.triggerChange(s.destPos,!0),a())},e.getFinalPos=function(t,i){var n=this;return ze(t,function(t,e){return t>=i[e]-1e-6&&t<=i[e]+1e-6?i[e]:Ye(t,n.getRoundUnit(t,e))})},e.getRoundUnit=function(t,e){var i=this.options.round,n=null;return i||(e=this.axm.getAxisOptions(e),t=Math.max(je(e.range[0]),je(e.range[1]),je(t)),n=1/Math.pow(10,t)),n||i},e.getUserControll=function(t){t=t.setTo();return t.destPos=this.axm.get(t.destPos),t.duration=He(t.duration,this.options.minimumDuration,this.options.maximumDuration),t},e.animateTo=function(t,e,i){var n=this,r=this.createAnimationParam(t,e,i),t=Ae({},r.depaPos),e=this.em.triggerAnimationStart(r),r=this.getUserControll(r);!e&&this.axm.every(r.destPos,function(t,e){return Me(t,e.range,e.circular)})&&console.warn("You can't stop the 'animation' event when 'circular' is true."),e&&!We(r.destPos,t)&&(e=i&&i.event||null,this.animateLoop({depaPos:t,destPos:r.destPos,duration:r.duration,delta:this.axm.getDelta(t,r.destPos),isTrusted:!!e,inputEvent:e,input:i&&i.input||null},function(){return n.animationEnd()}))},e.easing=function(t){return 1<t?1:this.options.easing(t)},e.setTo=function(t,e){void 0===e&&(e=0);var i=Object.keys(t);this.grab(i);var n=this.axm.get(i);if(We(t,n))return this;this.itm.setInterrupt(!0);t=Qe(t,function(t,e){return n[e]!==t});return Object.keys(t).length&&(We(t=this.axm.map(t,function(t,e){var i=e.range,e=e.circular;return e&&(e[0]||e[1])?t:Se(t,i,e)}),n)||(0<e?this.animateTo(t,e):(this.em.triggerChange(t),this.finish(!1)))),this},e.setBy=function(i,t){return void 0===t&&(t=0),this.setTo(ze(this.axm.get(Object.keys(i)),function(t,e){return t+i[e]}),t)},t}(),Ke=function(){function t(t){this.axes=t}var e=t.prototype;return e.triggerHold=function(t,e){t=this.getRoundPos(t).roundPos;this.axes.trigger("hold",{pos:t,input:e.input||null,inputEvent:e.event||null,isTrusted:!0})},e.triggerRelease=function(t){var e=this.getRoundPos(t.destPos,t.depaPos),i=e.roundPos,e=e.roundDepa;t.destPos=i,t.depaPos=e,t.setTo=this.createUserControll(t.destPos,t.duration),this.axes.trigger("release",t)},e.triggerChange=function(t,e,i,n,r){void 0===r&&(r=!1);var o=this.am,s=o.axm,o=o.getEventInfo(),t=this.getRoundPos(t,i),i=t.roundPos,t=t.roundDepa,i=s.moveTo(i,t),t=n&&n.event||o&&o.event||null,o={pos:i.pos,delta:i.delta,holding:r,inputEvent:t,isTrusted:!!t,input:n&&n.input||o&&o.input||null,set:t?this.createUserControll(i.pos):function(){}},i=this.axes.trigger("change",o);return t&&s.set(o.set().destPos),i},e.triggerAnimationStart=function(t){var e=this.getRoundPos(t.destPos,t.depaPos),i=e.roundPos,e=e.roundDepa;return t.destPos=i,t.depaPos=e,t.setTo=this.createUserControll(t.destPos,t.duration),this.axes.trigger("animationStart",t)},e.triggerAnimationEnd=function(t){void 0===t&&(t=!1),this.axes.trigger("animationEnd",{isTrusted:t})},e.triggerFinish=function(t){void 0===t&&(t=!1),this.axes.trigger("finish",{isTrusted:t})},e.createUserControll=function(t,e){void 0===e&&(e=0);var i={destPos:Ae({},t),duration:e};return function(t,e){return t&&(i.destPos=Ae({},t)),void 0!==e&&(i.duration=e),i}},e.setAnimationManager=function(t){this.am=t},e.destroy=function(){this.axes.off()},e.getRoundPos=function(t,e){var i=this.axes.options.round;return{roundPos:Ge(t,i),roundDepa:Ge(e,i)}},t}(),Ze=function(){function t(t){this.options=t,this._prevented=!1}var e=t.prototype;return e.isInterrupting=function(){return this.options.interruptable||this._prevented},e.isInterrupted=function(){return!this.options.interruptable&&this._prevented},e.setInterrupt=function(t){this.options.interruptable||(this._prevented=t)},t}(),Je=function(){function t(t,e){var i=this;this.axis=t,this.options=e,this._complementOptions(),this._pos=Object.keys(this.axis).reduce(function(t,e){return t[e]=i.axis[e].range[0],t},{})}var e=t.prototype;return e._complementOptions=function(){var r=this;Object.keys(this.axis).forEach(function(n){r.axis[n]=Ae({range:[0,100],bounce:[0,0],circular:[!1,!1]},r.axis[n]),["bounce","circular"].forEach(function(t){var e=r.axis,i=e[n][t];/string|number|boolean/.test(typeof i)&&(e[n][t]=[i,i])})})},e.getDelta=function(t,e){var i=this.get(t);return ze(this.get(e),function(t,e){return t-i[e]})},e.get=function(t){var i=this;return t&&Array.isArray(t)?t.reduce(function(t,e){return e&&e in i._pos&&(t[e]=i._pos[e]),t},{}):Ae(Ae({},this._pos),t||{})},e.moveTo=function(i,n){void 0===n&&(n=this._pos);var t=ze(this._pos,function(t,e){return e in i&&e in n?i[e]-n[e]:0});return this.set(this.map(i,function(t,e){return e?De(t,e.range,e.circular):0})),{pos:Ae({},this._pos),delta:t}},e.set=function(t){for(var e in t)e&&e in this._pos&&(this._pos[e]=t[e])},e.every=function(t,i){var n=this.axis;return Xe(t,function(t,e){return i(t,n[e],e)})},e.filter=function(t,i){var n=this.axis;return Qe(t,function(t,e){return i(t,n[e],e)})},e.map=function(t,i){var n=this.axis;return ze(t,function(t,e){return i(t,n[e],e)})},e.isOutside=function(t){return!this.every(t?this.get(t):this._pos,function(t,e){return!Oe(t,e.range)})},e.getAxisOptions=function(t){return this.axis[t]},t}(),$e=function(){function t(t){var e=t.options,i=t.itm,n=t.em,r=t.axm,t=t.am;this.isOutside=!1,this.moveDistance=null,this.isStopped=!1,this.options=e,this.itm=i,this.em=n,this.axm=r,this.am=t}var e=t.prototype;return e.atOutside=function(t){var o=this;if(this.isOutside)return this.axm.map(t,function(t,e){var i=e.range[0]-e.bounce[0],e=e.range[1]+e.bounce[1];return e<t?e:t<i?i:t});var s=this.am.easing(1e-5)/1e-5;return this.axm.map(t,function(t,e){var i=e.range[0],n=e.range[1],r=e.bounce,e=e.circular;return e&&(e[0]||e[1])?t:t<i?i-o.am.easing((i-t)/(r[0]*s))*r[0]:n<t?n+o.am.easing((t-n)/(r[1]*s))*r[1]:t})},e.get=function(t){return this.axm.get(t.axes)},e.hold=function(t,e){!this.itm.isInterrupted()&&t.axes.length&&(e={input:t,event:e},this.isStopped=!1,this.itm.setInterrupt(!0),this.am.grab(t.axes,e),this.moveDistance||this.em.triggerHold(this.axm.get(),e),this.isOutside=this.axm.isOutside(t.axes),this.moveDistance=this.axm.get(t.axes))},e.change=function(t,e,i){var n,r;this.isStopped||!this.itm.isInterrupting()||this.axm.every(i,function(t){return 0===t})||(r=ze(n=this.moveDistance||this.axm.get(t.axes),function(t,e){return t+(i[e]||0)}),this.moveDistance&&(this.moveDistance=r),this.isOutside&&this.axm.every(n,function(t,e){return!Oe(t,e.range)})&&(this.isOutside=!1),n=this.atOutside(n),r=this.atOutside(r),this.em.triggerChange(r,!1,n,{input:t,event:e},!0)||(this.isStopped=!0,this.moveDistance=null,this.am.finish(!1)))},e.release=function(t,e,i,n){var r,o;!this.isStopped&&this.itm.isInterrupting()&&this.moveDistance&&(r=this.axm.get(t.axes),o=this.axm.get(),i=this.axm.get(this.axm.map(i,function(t,e,i){return e.circular&&(e.circular[0]||e.circular[1])?r[i]+t:Se(r[i]+t,e.range,e.circular,e.bounce)})),0===(n=this.am.getDuration(i,r,n))&&(i=Ae({},o)),i={depaPos:o,destPos:i,duration:n,delta:this.axm.getDelta(o,i),inputEvent:e,input:t,isTrusted:!0},this.em.triggerRelease(i),this.moveDistance=null,t={input:t,event:e},(i=We((e=this.am.getUserControll(i)).destPos,o))||0===e.duration?(i||this.em.triggerChange(e.destPos,!1,o,t,!0),this.itm.setInterrupt(!1),this.axm.isOutside()?this.am.restore(t):this.em.triggerFinish(!0)):this.am.animateTo(e.destPos,e.duration,t))},t}(),ti="ontouchstart"in Ie&&"safari"===O().browser.name,ei=function(){if("undefined"==typeof document)return"";for(var t=(document.head||document.getElementsByTagName("head")[0]).style,e=["transform","webkitTransform","msTransform","mozTransform"],i=0,n=e.length;i<n;i++)if(e[i]in t)return e[i];return""}(),ii=function(r){function t(){this.constructor=e}var e;function i(t,e,i){void 0===t&&(t={}),void 0===e&&(e={});var n=r.call(this)||this;return n.axis=t,n._inputs=[],n.options=Ae({easing:function(t){return 1-Math.pow(1-t,3)},interruptable:!0,maximumDuration:1/0,minimumDuration:0,deceleration:6e-4,round:null},e),n.itm=new Ze(n.options),n.axm=new Je(n.axis,n.options),n.em=new Ke(n),n.am=new qe(n),n.io=new $e(n),n.em.setAnimationManager(n.am),i&&n.em.triggerChange(i),n}Pe(e=i,n=r),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t);var n=i.prototype;return n.connect=function(t,e){var i="string"==typeof t?t.split(" "):t.concat();return~this._inputs.indexOf(e)&&this.disconnect(e),"hammer"in e&&((t=this._inputs.filter(function(t){return t.hammer&&t.element===e.element})).length&&(e.hammer=t[0].hammer)),e.mapAxes(i),e.connect(this.io),this._inputs.push(e),this},n.disconnect=function(t){return t?0<=(t=this._inputs.indexOf(t))&&(this._inputs[t].disconnect(),this._inputs.splice(t,1)):(this._inputs.forEach(function(t){return t.disconnect()}),this._inputs=[]),this},n.get=function(t){return this.axm.get(t)},n.setTo=function(t,e){return void 0===e&&(e=0),this.am.setTo(t,e),this},n.setBy=function(t,e){return void 0===e&&(e=0),this.am.setBy(t,e),this},n.isBounceArea=function(t){return this.axm.isOutside(t)},n.destroy=function(){this.disconnect(),this.em.destroy()},i.VERSION="2.7.2",i.TRANSFORM=ei,i.DIRECTION_NONE=Rt,i.DIRECTION_LEFT=bt,i.DIRECTION_RIGHT=Ct,i.DIRECTION_UP=Pt,i.DIRECTION_DOWN=It,i.DIRECTION_HORIZONTAL=At,i.DIRECTION_VERTICAL=St,i.DIRECTION_ALL=Ot,i}(t),ni="PointerEvent"in Ie||"MSPointerEvent"in Ie,ri="ontouchstart"in Ie,oi="_EGJS_AXES_INPUTTYPE_";function si(n,t){return t.reduce(function(t,e,i){return n[i]&&(t[n[i]]=e),t},{})}function ai(t,e){try{return new Ce(t,Ae({},e))}catch(t){return null}}function hi(t){void 0===t&&(t=[]);var e=!1,i=!1,n=!1;return t.forEach(function(t){switch(t){case"mouse":i=!0;break;case"touch":e=ri;break;case"pointer":n=ni}}),n?ne:e&&i?me:e?ae:i?le:null}function ui(t,e,i){return i?!!(e===Ot||e&t&&i&t):!!(e&t)}var ci=function(){function t(t,e){if(this.axes=[],this.hammer=null,this.element=null,this.panRecognizer=null,this.isRightEdge=!1,this.rightEdgeTimer=0,this.panFlag=!1,void 0===Ce)throw new Error("The Hammerjs must be loaded before eg.Axes.PanInput.\nhttp://hammerjs.github.io/");this.element=Le(t),this.options=Ae({inputType:["touch","mouse","pointer"],scale:[1,1],thresholdAngle:45,threshold:0,iOSEdgeSwipeThreshold:30,hammerManagerOptions:{cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",userDrag:"none"}}},e),this.onHammerInput=this.onHammerInput.bind(this),this.onPanmove=this.onPanmove.bind(this),this.onPanend=this.onPanend.bind(this)}var e=t.prototype;return e.mapAxes=function(t){var e=!!t[0],i=!!t[1];this._direction=e&&i?Ot:e?At:i?St:Rt,this.axes=t},e.connect=function(t){var e={direction:this._direction,threshold:this.options.threshold};if(this.hammer)this.removeRecognizer(),this.dettachEvent();else{var i=(i=this.element[oi])||String(Math.round(Math.random()*(new Date).getTime())),n=hi(this.options.inputType);if(!n)throw new Error("Wrong inputType parameter!");this.hammer=ai(this.element,Ae({inputClass:n},this.options.hammerManagerOptions)),this.element[oi]=i}return this.panRecognizer=new Ee(e),this.hammer.add(this.panRecognizer),this.attachEvent(t),this},e.disconnect=function(){return this.removeRecognizer(),this.hammer&&this.dettachEvent(),this._direction=Rt,this},e.destroy=function(){this.disconnect(),this.hammer&&0===this.hammer.recognizers.length&&this.hammer.destroy(),delete this.element[oi],this.element=null,this.hammer=null},e.enable=function(){return this.hammer&&(this.hammer.get("pan").options.enable=!0),this},e.disable=function(){return this.hammer&&(this.hammer.get("pan").options.enable=!1),this},e.isEnable=function(){return!(!this.hammer||!this.hammer.get("pan").options.enable)},e.removeRecognizer=function(){this.hammer&&this.panRecognizer&&(this.hammer.remove(this.panRecognizer),this.panRecognizer=null)},e.onHammerInput=function(t){var e;this.isEnable()&&(t.isFirst?(this.panFlag=!1)!==t.srcEvent.cancelable&&(e=this.options.iOSEdgeSwipeThreshold,this.observer.hold(this,t),this.isRightEdge=ti&&t.center.x>window.innerWidth-e,this.panFlag=!0):t.isFinal&&this.onPanend(t))},e.onPanmove=function(t){var e=this;if(this.panFlag){var i=(i=t.angle,(r=this.options.thresholdAngle)<0||90<r?Rt:(i=Math.abs(i),r<i&&i<180-r?St:At)),n=this.hammer.session.prevInput;if(n&&ti){if(t.center.x<0)return void this.onPanend(Ae(Ae({},n),{velocityX:0,velocityY:0,offsetX:0,offsetY:0}));this.isRightEdge&&(clearTimeout(this.rightEdgeTimer),o=this.options.iOSEdgeSwipeThreshold,t.deltaX<-o?this.isRightEdge=!1:this.rightEdgeTimer=window.setTimeout(function(){e.onPanend(Ae(Ae({},n),{velocityX:0,velocityY:0,offsetX:0,offsetY:0}))},100))}n?(t.offsetX=t.deltaX-n.deltaX,t.offsetY=t.deltaY-n.deltaY):(t.offsetX=0,t.offsetY=0);var i,r=this.getOffset([t.offsetX,t.offsetY],[ui(At,this._direction,i),ui(St,this._direction,i)]),o=r.some(function(t){return 0!==t});o&&(!1!==(i=t.srcEvent).cancelable&&i.preventDefault(),i.stopPropagation()),(t.preventSystemEvent=o)&&this.observer.change(this,t,si(this.axes,r))}},e.onPanend=function(t){var e,i,n,r;this.panFlag&&(clearTimeout(this.rightEdgeTimer),this.panFlag=!1,e=this.getOffset([Math.abs(t.velocityX)*(t.deltaX<0?-1:1),Math.abs(t.velocityY)*(t.deltaY<0?-1:1)],[ui(At,this._direction),ui(St,this._direction)]),i=e,n=this.observer.options.deceleration,r=Math.sqrt(i[0]*i[0]+i[1]*i[1]),n=Math.abs(r/-n),e=[i[0]/2*n,i[1]/2*n],this.observer.release(this,t,si(this.axes,e)))},e.attachEvent=function(t){this.observer=t,this.hammer.on("hammer.input",this.onHammerInput).on("panstart panmove",this.onPanmove)},e.dettachEvent=function(){this.hammer.off("hammer.input",this.onHammerInput).off("panstart panmove",this.onPanmove),this.observer=null},e.getOffset=function(t,e){var i=[0,0],n=this.options.scale;return e[0]&&(i[0]=t[0]*n[0]),e[1]&&(i[1]=t[1]*n[1]),i},t}(),li=function(){function t(t,e){if(this.axes=[],this.hammer=null,this.element=null,this._base=null,this._prev=null,this.pinchRecognizer=null,void 0===Ce)throw new Error("The Hammerjs must be loaded before eg.Axes.PinchInput.\nhttp://hammerjs.github.io/");this.element=Le(t),this.options=Ae({scale:1,threshold:0,inputType:["touch","pointer"],hammerManagerOptions:{cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",userDrag:"none"}}},e),this.onPinchStart=this.onPinchStart.bind(this),this.onPinchMove=this.onPinchMove.bind(this),this.onPinchEnd=this.onPinchEnd.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){var e={threshold:this.options.threshold};if(this.hammer)this.removeRecognizer(),this.dettachEvent();else{var i=(i=this.element[oi])||String(Math.round(Math.random()*(new Date).getTime())),n=hi(this.options.inputType);if(!n)throw new Error("Wrong inputType parameter!");this.hammer=ai(this.element,Ae({inputClass:n},this.options.hammerManagerOptions)),this.element[oi]=i}return this.pinchRecognizer=new Te(e),this.hammer.add(this.pinchRecognizer),this.attachEvent(t),this},e.disconnect=function(){return this.removeRecognizer(),this.hammer&&(this.hammer.remove(this.pinchRecognizer),this.pinchRecognizer=null,this.dettachEvent()),this},e.destroy=function(){this.disconnect(),this.hammer&&0===this.hammer.recognizers.length&&this.hammer.destroy(),delete this.element[oi],this.element=null,this.hammer=null},e.removeRecognizer=function(){this.hammer&&this.pinchRecognizer&&(this.hammer.remove(this.pinchRecognizer),this.pinchRecognizer=null)},e.onPinchStart=function(t){this._base=this.observer.get(this)[this.axes[0]];var e=this.getOffset(t.scale);this.observer.hold(this,t),this.observer.change(this,t,si(this.axes,[e])),this._prev=t.scale},e.onPinchMove=function(t){var e=this.getOffset(t.scale,this._prev);this.observer.change(this,t,si(this.axes,[e])),this._prev=t.scale},e.onPinchEnd=function(t){var e=this.getOffset(t.scale,this._prev);this.observer.change(this,t,si(this.axes,[e])),this.observer.release(this,t,si(this.axes,[0]),0),this._base=null,this._prev=null},e.getOffset=function(t,e){return void 0===e&&(e=1),this._base*(t-e)*this.options.scale},e.attachEvent=function(t){this.observer=t,this.hammer.on("pinchstart",this.onPinchStart).on("pinchmove",this.onPinchMove).on("pinchend",this.onPinchEnd)},e.dettachEvent=function(){this.hammer.off("pinchstart",this.onPinchStart).off("pinchmove",this.onPinchMove).off("pinchend",this.onPinchEnd),this.observer=null,this._prev=null},e.enable=function(){return this.hammer&&(this.hammer.get("pinch").options.enable=!0),this},e.disable=function(){return this.hammer&&(this.hammer.get("pinch").options.enable=!1),this},e.isEnable=function(){return!(!this.hammer||!this.hammer.get("pinch").options.enable)},t}(),di=function(){function t(t,e){this.axes=[],this.element=null,this._isEnabled=!1,this._isHolded=!1,this._timer=null,this.element=Le(t),this.options=Ae({scale:1,useNormalized:!0},e),this.onWheel=this.onWheel.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this.dettachEvent(),this.attachEvent(t),this},e.disconnect=function(){return this.dettachEvent(),this},e.destroy=function(){this.disconnect(),this.element=null},e.onWheel=function(t){var e,i=this;this._isEnabled&&(t.preventDefault(),0!==t.deltaY&&(this._isHolded||(this.observer.hold(this,t),this._isHolded=!0),e=(0<t.deltaY?-1:1)*this.options.scale*(this.options.useNormalized?1:Math.abs(t.deltaY)),this.observer.change(this,t,si(this.axes,[e])),clearTimeout(this._timer),this._timer=setTimeout(function(){i._isHolded&&(i._isHolded=!1,i.observer.release(i,t,si(i.axes,[0])))},50)))},e.attachEvent=function(t){this.observer=t,this.element.addEventListener("wheel",this.onWheel),this._isEnabled=!0},e.dettachEvent=function(){this.element.removeEventListener("wheel",this.onWheel),this._isEnabled=!1,this.observer=null,this._timer&&(clearTimeout(this._timer),this._timer=null)},e.enable=function(){return this._isEnabled=!0,this},e.disable=function(){return this._isEnabled=!1,this},e.isEnable=function(){return this._isEnabled},t}(),fi=function(){function t(t,e){this.axes=[],this.element=null,this._isEnabled=!1,this._isHolded=!1,this._timer=null,this.element=Le(t),this.options=Ae({scale:[1,1]},e),this.onKeydown=this.onKeydown.bind(this),this.onKeyup=this.onKeyup.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this.dettachEvent(),"0"!==this.element.getAttribute("tabindex")&&this.element.setAttribute("tabindex","0"),this.attachEvent(t),this},e.disconnect=function(){return this.dettachEvent(),this},e.destroy=function(){this.disconnect(),this.element=null},e.onKeydown=function(t){if(this._isEnabled){var e=!0,i=1,n=-1;switch(t.keyCode){case 37:case 65:i=-1;break;case 39:case 68:break;case 40:case 83:i=-1,n=1;break;case 38:case 87:n=1;break;default:e=!1}(-1===n&&!this.axes[0]||1===n&&!this.axes[1])&&(e=!1),e&&(t=-1===n?[+this.options.scale[0]*i,0]:[0,+this.options.scale[1]*i],this._isHolded||(this.observer.hold(this,event),this._isHolded=!0),clearTimeout(this._timer),this.observer.change(this,event,si(this.axes,t)))}},e.onKeyup=function(t){var e=this;this._isHolded&&(clearTimeout(this._timer),this._timer=setTimeout(function(){e.observer.release(e,t,si(e.axes,[0,0])),e._isHolded=!1},80))},e.attachEvent=function(t){this.observer=t,this.element.addEventListener("keydown",this.onKeydown,!1),this.element.addEventListener("keypress",this.onKeydown,!1),this.element.addEventListener("keyup",this.onKeyup,!1),this._isEnabled=!0},e.dettachEvent=function(){this.element.removeEventListener("keydown",this.onKeydown,!1),this.element.removeEventListener("keypress",this.onKeydown,!1),this.element.removeEventListener("keyup",this.onKeyup,!1),this._isEnabled=!1,this.observer=null},e.enable=function(){return this._isEnabled=!0,this},e.disable=function(){return this._isEnabled=!1,this},e.isEnable=function(){return this._isEnabled},t}(),pi=1e-6,mi="undefined"!=typeof Float32Array?Float32Array:Array,vi=Math.PI/180;function gi(t){return t*vi}function _i(){var t=new mi(9);return mi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function yi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function xi(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=c*s-a*u,d=-c*o+a*h,f=u*o-s*h,e=i*l+n*d+r*f;return e?(e=1/e,t[0]=l*e,t[1]=(-c*n+r*u)*e,t[2]=(a*n-r*s)*e,t[3]=d*e,t[4]=(c*i-r*h)*e,t[5]=(-a*i+r*o)*e,t[6]=f*e,t[7]=(-u*i+n*h)*e,t[8]=(s*i-n*o)*e,t):null}function wi(){var t=new mi(16);return mi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ei(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],h=e[7],u=e[8],c=e[9],l=e[10],i=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*n,t[5]=s*r+c*n,t[6]=a*r+l*n,t[7]=h*r+i*n,t[8]=u*r-o*n,t[9]=c*r-s*n,t[10]=l*r-a*n,t[11]=i*r-h*n,t}function Ti(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],u=e[8],c=e[9],l=e[10],i=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-u*n,t[1]=s*r-c*n,t[2]=a*r-l*n,t[3]=h*r-i*n,t[8]=o*n+u*r,t[9]=s*n+c*r,t[10]=a*n+l*r,t[11]=h*n+i*r,t}function Ri(t,e,i,n,r){e=1/Math.tan(e/2);return t[0]=e/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(e=1/(n-r),t[10]=(r+n)*e,t[14]=2*r*n*e):(t[10]=-1,t[14]=-2*n),t}function bi(){var t=new mi(3);return mi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ci(t){var e=t[0],i=t[1],t=t[2];return Math.hypot(e,i,t)}function Pi(t,e,i){var n=new mi(3);return n[0]=t,n[1]=e,n[2]=i,n}function Ii(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ai(t,e){var i=e[0],n=e[1],r=e[2],r=i*i+n*n+r*r;return 0<r&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Si(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Oi(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],e=i[1],i=i[2];return t[0]=r*i-o*e,t[1]=o*s-n*i,t[2]=n*e-r*s,t}function Mi(t,e,i){var n=e[0],r=e[1],e=e[2];return t[0]=n*i[0]+r*i[3]+e*i[6],t[1]=n*i[1]+r*i[4]+e*i[7],t[2]=n*i[2]+r*i[5]+e*i[8],t}function Di(t,e,i){var n=i[0],r=i[1],o=i[2],s=i[3],a=e[0],h=e[1],u=e[2],c=r*u-o*h,l=o*a-n*u,i=n*h-r*a,e=r*i-o*l,o=o*c-n*i,r=n*l-r*c,s=2*s;return c*=s,l*=s,i*=s,e*=2,o*=2,r*=2,t[0]=a+c+e,t[1]=h+l+o,t[2]=u+i+r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Fi,Li=Ci;Fi=bi();var Vi,Ni;Vi=new mi(4),mi!=Float32Array&&(Vi[0]=0,Vi[1]=0,Vi[2]=0,Vi[3]=0),Ni=Vi;function ki(){var t=new mi(4);return mi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ui(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function zi(t,e,i,n){var r,o=e[0],s=e[1],a=e[2],h=e[3],u=i[0],c=i[1],l=i[2],d=i[3],e=o*u+s*c+a*l+h*d;return e<0&&(e=-e,u=-u,c=-c,l=-l,d=-d),n=pi<1-e?(i=Math.acos(e),e=Math.sin(i),r=Math.sin((1-n)*i)/e,Math.sin(n*i)/e):(r=1-n,n),t[0]=r*o+n*u,t[1]=r*s+n*c,t[2]=r*a+n*l,t[3]=r*h+n*d,t}var Qi,Xi,Wi,Bi,Yi,Gi,ji=function(t){var e=new mi(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Hi=function(t,e,i,n){var r=new mi(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},qi=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ki=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3];return 0<(e=i*i+n*n+r*r+o*o)&&(e=1/Math.sqrt(e)),t[0]=i*e,t[1]=n*e,t[2]=r*e,t[3]=o*e,t},Zi=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ji=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=e[0],a=e[1],t=e[2],e=e[3];return Math.abs(i-s)<=pi*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=pi*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-t)<=pi*Math.max(1,Math.abs(r),Math.abs(t))&&Math.abs(o-e)<=pi*Math.max(1,Math.abs(o),Math.abs(e))};Qi=bi(),Xi=Pi(1,0,0),Wi=Pi(0,1,0),Bi=ki(),Yi=ki(),Gi=_i();function $i(t,e){var i=new mi(2);return i[0]=t,i[1]=e,i}function tn(t,e){return t[0]=e[0],t[1]=e[1],t}function en(t,e){var i=e[0],n=e[1],n=i*i+n*n;return 0<n&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}var nn,rn;nn=new mi(2),mi!=Float32Array&&(nn[0]=0,nn[1]=0),rn=nn;function on(t){return 180*t/Math.PI}var sn={isPowerOfTwo:function(t){return t&&0==(t&t-1)}};sn.extractPitchFromQuat=function(t){var e,t=(e=t,Di(t=Pi(0,0,1),t,e),t);return-1*Math.atan2(t[1],Math.sqrt(Math.pow(t[0],2)+Math.pow(t[2],2)))},sn.hypot=Math.hypot||function(t,e){return Math.sqrt(t*t+e*e)};var an={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};function hn(t,e){var i=t[0]*e[1]-e[0]*t[1];return-Math.atan2(i,(e=e,(t=t)[0]*e[0]+t[1]*e[1]))}an[an.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},an[an.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},an[an.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]},sn.yawOffsetBetween=function(t,e){t=$i(t[0],t[2]),e=$i(e[0],e[2]);return en(t,t),en(e,e),-hn(t,e)},sn.sign=function(t){return Math.sign?Math.sign(t):Number(0<t)-Number(t<0)||+t},sn.toDegree=on,sn.getRotationDelta=function(t,e,i){var n=Pi(an[i].targetAxis[0],an[i].targetAxis[1],an[i].targetAxis[2]),r=an[i].meshPoint,o=ji(t),s=ji(e);Ki(o,o),Ki(s,s);var a=Pi(0,0,1),h=Pi(0,0,1);Di(a,a,o),Di(h,h,s),Di(n,n,s);var u=0<Si(n,Oi(bi(),a,h))?1:-1,c=Pi(r[0],r[1],r[2]),t=i!==an.YAW_DELTA_BY_YAW?Pi(0,u,0):Pi(u,0,0);Di(c,c,s),Di(t,t,s),e=c,n=t,Oi(c=bi(),e,n),Ai(c,c),t=c[0],e=c[1],n=c[2],Di(h=Pi(r[0],r[1],r[2]),h,s),Di(a=Pi(r[0],r[1],r[2]),a,o),s=Math.abs(a[0]*t+a[1]*e+a[2]*n),Ii(r=bi(),a,(o=bi(),a=c,c=s,o[0]=a[0]*c,o[1]=a[1]*c,o[2]=a[2]*c,o)),1<(o=(r[0]*h[0]+r[1]*h[1]+r[2]*h[2])/(Ci(r)*Ci(h)))&&(o=1);var o=Math.acos(o),r=Oi(bi(),h,r),s=t*r[0]+e*r[1]+n*r[2],s=i!==an.YAW_DELTA_BY_YAW?0<s?1:-1:s<0?1:-1;return on(o*s*u)},sn.angleBetweenVec2=hn;var un,cn,ln=M.MathUtil||{};ln.degToRad=Math.PI/180,ln.radToDeg=180/Math.PI,ln.Vector2=function(t,e){this.x=t||0,this.y=e||0},ln.Vector2.prototype={constructor:ln.Vector2,set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},ln.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0},ln.Vector3.prototype={constructor:ln.Vector3,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=this.length();return 0!==t?(t=1/t,this.multiplyScalar(t)):(this.x=0,this.y=0,this.z=0),this},multiplyScalar:function(t){this.x*=t,this.y*=t,this.z*=t},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z,a=t.w,h=a*e+o*n-s*i,u=a*i+s*e-r*n,t=a*n+r*i-o*e,n=-r*e-o*i-s*n;return this.x=h*a+n*-r+u*-s-t*-o,this.y=u*a+n*-o+t*-r-h*-s,this.z=t*a+n*-s+h*-o-u*-r,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,o=e.x,t=e.y,e=e.z;return this.x=n*e-r*t,this.y=r*o-i*e,this.z=i*t-n*o,this}},ln.Quaternion=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1},ln.Quaternion.prototype={constructor:ln.Quaternion,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEulerXYZ:function(t,e,i){var n=Math.cos(t/2),r=Math.cos(e/2),o=Math.cos(i/2),t=Math.sin(t/2),e=Math.sin(e/2),i=Math.sin(i/2);return this.x=t*r*o+n*e*i,this.y=n*e*o-t*r*i,this.z=n*r*i+t*e*o,this.w=n*r*o-t*e*i,this},setFromEulerYXZ:function(t,e,i){var n=Math.cos(t/2),r=Math.cos(e/2),o=Math.cos(i/2),t=Math.sin(t/2),e=Math.sin(e/2),i=Math.sin(i/2);return this.x=t*r*o+n*e*i,this.y=n*e*o-t*r*i,this.z=n*r*i-t*e*o,this.w=n*r*o+t*e*i,this},setFromAxisAngle:function(t,e){var i=e/2,e=Math.sin(i);return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this.w=Math.cos(i),this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var i=t.x,n=t.y,r=t.z,o=t.w,s=e.x,a=e.y,t=e.z,e=e.w;return this.x=i*e+o*s+n*t-r*a,this.y=n*e+o*a+r*s-i*t,this.z=r*e+o*t+i*a-n*s,this.w=o*e-i*s-n*a-r*t,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this.x,n=this.y,r=this.z,o=this.w,s=o*t.w+i*t.x+n*t.y+r*t.z;if(s<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,s=-s):this.copy(t),1<=s)return this.w=o,this.x=i,this.y=n,this.z=r,this;var a=Math.acos(s),t=Math.sqrt(1-s*s);if(Math.abs(t)<.001)return this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this;s=Math.sin((1-e)*a)/t,t=Math.sin(e*a)/t;return this.w=o*s+this.w*t,this.x=i*s+this.x*t,this.y=n*s+this.y*t,this.z=r*s+this.z*t,this},setFromUnitVectors:function(t,e){return void 0===un&&(un=new ln.Vector3),(cn=t.dot(e)+1)<1e-6?(cn=0,Math.abs(t.x)>Math.abs(t.z)?un.set(-t.y,t.x,0):un.set(0,-t.z,t.y)):un.crossVectors(t,e),this.x=un.x,this.y=un.y,this.z=un.z,this.w=cn,this.normalize(),this}};var dn,fn,pn,mn,vn,gn,_n,yn,xn,wn=null!==(L=null==F?void 0:F.userAgent)&&void 0!==L?L:"",En=M.Util||{};function Tn(t,e,i,n,r){c=t,s=n?n.fieldOfView:null,o=r.depthNear,u=r.depthFar,l=Math.tan(s?s.upDegrees*gn:_n),h=Math.tan(s?s.downDegrees*gn:_n),f=Math.tan(s?s.leftDegrees*gn:_n),d=Math.tan(s?s.rightDegrees*gn:_n),a=2/(f+d),s=2/(l+h),c[0]=a,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s,c[6]=0,c[7]=0,c[8]=-(f-d)*a*.5,c[9]=(l-h)*s*.5,c[10]=u/(o-u),c[11]=-1,c[12]=0,c[13]=0,c[14]=u*o/(o-u),c[15]=0;var o,s,a,h,u,c,l,d,f,p,m,v,g,_,y,x,w,E,T,R,b,C,P,I,A,S,t=i.orientation||yn,r=i.position||xn;f=e,d=r,l=(a=t)[0],h=a[1],s=a[2],o=a[3],c=l*(u=l+l),r=l*(i=h+h),a=l*(t=s+s),l=h*i,h*=t,s*=t,u*=o,i*=o,t*=o,f[0]=1-(l+s),f[1]=r+t,f[2]=a-i,f[3]=0,f[4]=r-t,f[5]=1-(c+s),f[6]=h+u,f[7]=0,f[8]=a+i,f[9]=h-u,f[10]=1-(c+l),f[11]=0,f[12]=d[0],f[13]=d[1],f[14]=d[2],f[15]=1,n&&(b=A=e,R=n.offset,I=R[0],P=R[1],C=R[2],b===A?(A[12]=b[0]*I+b[4]*P+b[8]*C+b[12],A[13]=b[1]*I+b[5]*P+b[9]*C+b[13],A[14]=b[2]*I+b[6]*P+b[10]*C+b[14],A[15]=b[3]*I+b[7]*P+b[11]*C+b[15]):(p=b[0],g=b[1],x=b[2],E=b[3],m=b[4],_=b[5],S=b[6],T=b[7],v=b[8],y=b[9],w=b[10],R=b[11],A[0]=p,A[1]=g,A[2]=x,A[3]=E,A[4]=m,A[5]=_,A[6]=S,A[7]=T,A[8]=v,A[9]=y,A[10]=w,A[11]=R,A[12]=p*I+m*P+v*C+b[12],A[13]=g*I+_*P+y*C+b[13],A[14]=x*I+S*P+w*C+b[14],A[15]=E*I+T*P+R*C+b[15])),s=(t=r=e)[0],a=t[1],i=t[2],h=t[3],u=t[4],c=t[5],l=t[6],d=t[7],f=t[8],n=t[9],p=t[10],m=t[11],v=t[12],g=t[13],_=t[14],y=t[15],(t=(x=s*c-a*u)*(S=p*y-m*_)-(w=s*l-i*u)*(A=n*y-m*g)+(E=s*d-h*u)*(I=n*_-p*g)+(T=a*l-i*c)*(P=f*y-m*v)-(R=a*d-h*c)*(C=f*_-p*v)+(b=i*d-h*l)*(e=f*g-n*v))&&(t=1/t,r[0]=(c*S-l*A+d*I)*t,r[1]=(i*A-a*S-h*I)*t,r[2]=(g*b-_*R+y*T)*t,r[3]=(p*R-n*b-m*T)*t,r[4]=(l*P-u*S-d*C)*t,r[5]=(s*S-i*P+h*C)*t,r[6]=(_*E-v*b-y*w)*t,r[7]=(f*b-p*E+m*w)*t,r[8]=(u*A-c*P+d*e)*t,r[9]=(a*P-s*A-h*e)*t,r[10]=(v*R-g*E+y*x)*t,r[11]=(n*E-f*R-m*x)*t,r[12]=(c*C-u*I-l*e)*t,r[13]=(s*I-a*C+i*e)*t,r[14]=(g*w-v*T-_*x)*t,r[15]=(f*T-n*w+p*x)*t)}En.MIN_TIMESTEP=.001,En.MAX_TIMESTEP=1,En.base64=function(t,e){return"data:"+t+";base64,"+e},En.clamp=function(t,e,i){return Math.min(Math.max(e,t),i)},En.lerp=function(t,e,i){return t+(e-t)*i},En.isIOS=(dn=/iPad|iPhone|iPod/.test(null==F?void 0:F.platform),function(){return dn}),En.isWebViewAndroid=(fn=-1!==wn.indexOf("Version")&&-1!==wn.indexOf("Android")&&-1!==wn.indexOf("Chrome"),function(){return fn}),En.isSafari=(pn=/^((?!chrome|android).)*safari/i.test(wn),function(){return pn}),En.isFirefoxAndroid=(mn=-1!==wn.indexOf("Firefox")&&-1!==wn.indexOf("Android"),function(){return mn}),En.isR7=(vn=-1!==wn.indexOf("R7 Build"),function(){return vn}),En.isLandscapeMode=function(){var t=90===M.orientation||-90===M.orientation;return En.isR7()?!t:t},En.isTimestampDeltaValid=function(t){return!isNaN(t)&&(!(t<=En.MIN_TIMESTEP)&&!(t>En.MAX_TIMESTEP))},En.getScreenWidth=function(){return Math.max(M.screen.width,M.screen.height)*M.devicePixelRatio},En.getScreenHeight=function(){return Math.min(M.screen.width,M.screen.height)*M.devicePixelRatio},En.requestFullscreen=function(t){if(En.isWebViewAndroid())return!1;if(t.requestFullscreen)t.requestFullscreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else{if(!t.msRequestFullscreen)return!1;t.msRequestFullscreen()}return!0},En.exitFullscreen=function(){if(D.exitFullscreen)D.exitFullscreen();else if(D.webkitExitFullscreen)D.webkitExitFullscreen();else if(D.mozCancelFullScreen)D.mozCancelFullScreen();else{if(!D.msExitFullscreen)return!1;D.msExitFullscreen()}return!0},En.getFullscreenElement=function(){return D.fullscreenElement||D.webkitFullscreenElement||D.mozFullScreenElement||D.msFullscreenElement},En.linkProgram=function(t,e,i,n){var r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e),t.compileShader(r);e=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(e,i),t.compileShader(e);var o,s=t.createProgram();for(o in t.attachShader(s,r),t.attachShader(s,e),n)t.bindAttribLocation(s,n[o],o);return t.linkProgram(s),t.deleteShader(r),t.deleteShader(e),s},En.getProgramUniforms=function(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r="",o=0;o<n;o++)i[r=t.getActiveUniform(e,o).name.replace("[0]","")]=t.getUniformLocation(e,r);return i},En.orthoMatrix=function(t,e,i,n,r,o,s){var a=1/(e-i),h=1/(n-r),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*h,t[14]=(s+o)*u,t[15]=1,t},En.copyArray=function(t,e){for(var i=0,n=t.length;i<n;i++)e[i]=t[i]},En.isMobile=function(){var t,e=!1;return t=wn||(null==F?void 0:F.vendor)||M.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},En.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},En.safariCssSizeWorkaround=function(t){var e,i;En.isIOS()&&(e=t.style.width,i=t.style.height,t.style.width=parseInt(e)+1+"px",t.style.height=parseInt(i)+"px",setTimeout(function(){t.style.width=e,t.style.height=i},100)),M.Util=En,M.canvas=t},En.isDebug=function(){return En.getQueryParameter("debug")},En.getQueryParameter=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},En.frameDataFromPose=(gn=Math.PI/180,_n=.25*Math.PI,yn=new Float32Array([0,0,0,1]),xn=new Float32Array([0,0,0]),function(t,e,i){return!(!t||!e)&&(t.pose=e,t.timestamp=e.timestamp,Tn(t.leftProjectionMatrix,t.leftViewMatrix,e,i.getEyeParameters("left"),i),Tn(t.rightProjectionMatrix,t.rightViewMatrix,e,i.getEyeParameters("right"),i),!0)}),En.isInsideCrossDomainIFrame=function(){var t=M.self!==M.top,e=En.getDomainFromUrl(D.referrer),i=En.getDomainFromUrl(M.location.href);return t&&e!==i},En.getDomainFromUrl=function(t){t=-1<t.indexOf("://")?t.split("/")[2]:t.split("/")[0];return t=t.split(":")[0]};var Rn=function(){function t(t){this.predictionTimeS=t,this.previousQ=new ln.Quaternion,this.previousTimestampS=null,this.deltaQ=new ln.Quaternion,this.outQ=new ln.Quaternion}return t.prototype.getPrediction=function(t,e,i){if(!this.previousTimestampS)return this.previousQ.copy(t),this.previousTimestampS=i,t;var n=new ln.Vector3;n.copy(e),n.normalize();e=e.length();if(e<20*ln.degToRad)return En.isDebug()&&console.log("Moving slowly, at %s deg/s: no prediction",(ln.radToDeg*e).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;this.previousTimestampS;e*=this.predictionTimeS;return this.deltaQ.setFromAxisAngle(n,e),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(t),this.previousTimestampS=i,this.outQ},t}(),V=-1,N=null,et=null,L=/Chrome\/([0-9]+)\.(?:[0-9]*)\.([0-9]*)\.([0-9]*)/i.exec(z);L&&(V=parseInt(L[1],10),N=L[2],et=L[3]);var bn=V,Cn=65===V&&"3325"===N&&parseInt(et,10)<148,Pn=/Android/i.test(z),In=[.2,.2],An={NONE:"none",YAWPITCH:"yawPitch",VR:"VR"},Sn=function(e){function t(){var t=e.call(this)||this;return t._onDeviceMotion=t._onDeviceMotion.bind(t),t._onDeviceOrientation=t._onDeviceOrientation.bind(t),t._onChromeWithoutDeviceMotion=t._onChromeWithoutDeviceMotion.bind(t),t.isWithoutDeviceMotion=Cn,t.isAndroid=Pn,t.stillGyroVec=bi(),t.rawGyroVec=bi(),t.adjustedGyroVec=bi(),t._timer=-1,t.lastDevicemotionTimestamp=0,t._isEnabled=!1,t.enable(),t}a(t,e);var i=t.prototype;return i.enable=function(){this.isAndroid&&M.addEventListener("deviceorientation",this._onDeviceOrientation),this.isWithoutDeviceMotion?M.addEventListener("deviceorientation",this._onChromeWithoutDeviceMotion):M.addEventListener("devicemotion",this._onDeviceMotion),this._isEnabled=!0},i.disable=function(){M.removeEventListener("deviceorientation",this._onDeviceOrientation),M.removeEventListener("deviceorientation",this._onChromeWithoutDeviceMotion),M.removeEventListener("devicemotion",this._onDeviceMotion),this._isEnabled=!1},i._onChromeWithoutDeviceMotion=function(t){var e=t.alpha,i=t.beta,t=t.gamma;null!==e&&(e=(e||0)*Math.PI/180,i=(i||0)*Math.PI/180,t=(t||0)*Math.PI/180,this.trigger("devicemotion",{inputEvent:{deviceorientation:{alpha:e,beta:i,gamma:-t}}}))},i._onDeviceOrientation=function(){var i=this;this._timer&&clearTimeout(this._timer),this._timer=M.setTimeout(function(){var t,e;(new Date).getTime()-i.lastDevicemotionTimestamp<200&&(t=i.stillGyroVec,e=i.rawGyroVec,t[0]=e[0],t[1]=e[1],t[2]=e[2])},200)},i._onDeviceMotion=function(t){var e,i,n=!(null==t.rotationRate.alpha),r=!(null==t.accelerationIncludingGravity.x);0!==t.interval&&n&&r&&((e=c({},t)).interval=t.interval,e.timeStamp=t.timeStamp,e.type=t.type,e.rotationRate={alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma},e.accelerationIncludingGravity={x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.z},e.acceleration={x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z},this.isAndroid&&(i=this.rawGyroVec,n=t.rotationRate.alpha||0,r=t.rotationRate.beta||0,t=t.rotationRate.gamma||0,i[0]=n,i[1]=r,i[2]=t,Ii(this.adjustedGyroVec,this.rawGyroVec,this.stillGyroVec),this.lastDevicemotionTimestamp=(new Date).getTime(),e.adjustedRotationRate={alpha:this.adjustedGyroVec[0],beta:this.adjustedGyroVec[1],gamma:this.adjustedGyroVec[2]}),this.trigger("devicemotion",{inputEvent:e}))},t}(t),On=function(){function t(t,e){this.set(t,e)}var e=t.prototype;return e.set=function(t,e){this.sample=t,this.timestampS=e},e.copy=function(t){this.set(t.sample,t.timestampS)},t}(),Mn=function(){function t(t){this.addGyroMeasurement=function(t,e){this.currentGyroMeasurement.set(t,e);e-=this.previousGyroMeasurement.timestampS;En.isTimestampDeltaValid(e)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},this.kFilter=t,this.currentAccelMeasurement=new On,this.currentGyroMeasurement=new On,this.previousGyroMeasurement=new On,En.isIOS()?this.filterQ=new ln.Quaternion(-1,0,0,1):this.filterQ=new ln.Quaternion(1,0,0,1),this.previousFilterQ=new ln.Quaternion,this.previousFilterQ.copy(this.filterQ),this.accelQ=new ln.Quaternion,this.isOrientationInitialized=!1,this.estimatedGravity=new ln.Vector3,this.measuredGravity=new ln.Vector3,this.gyroIntegralQ=new ln.Quaternion}var e=t.prototype;return e.addAccelMeasurement=function(t,e){this.currentAccelMeasurement.set(t,e)},e.getOrientation=function(){return this.filterQ},e.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,e=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(e),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(e);t=new ln.Quaternion;t.copy(this.filterQ),t.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(t),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();e=new ln.Quaternion;e.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),e.inverse(),En.isDebug()&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",ln.radToDeg*En.getQuaternionAngle(e),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));t=new ln.Quaternion;t.copy(this.filterQ),t.multiply(e),this.filterQ.slerp(t,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},e.accelToQuaternion_=function(t){var e=new ln.Vector3;e.copy(t),e.normalize();t=new ln.Quaternion;return t.setFromUnitVectors(new ln.Vector3(0,0,-1),e),t.inverse(),t},e.gyroToQuaternionDelta_=function(t,e){var i=new ln.Quaternion,n=new ln.Vector3;return n.copy(t),n.normalize(),i.setFromAxisAngle(n,t.length()*e),i},t}();Mn.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,e=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(e),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(e);t=new ln.Quaternion;t.copy(this.filterQ),t.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(t),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();e=new ln.Quaternion;e.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),e.inverse();t=new ln.Quaternion;t.copy(this.filterQ),t.multiply(e),this.filterQ.slerp(t,1-this.kFilter),this.previousFilterQ.copy(this.filterQ),this.isFilterQuaternionInitialized||(this.isFilterQuaternionInitialized=!0)},Mn.prototype.getOrientation=function(){return this.isFilterQuaternionInitialized?this.filterQ:null};var Dn=function(e){function t(){var t=e.call(this)||this;return t.deviceMotion=new Sn,t.accelerometer=new ln.Vector3,t.gyroscope=new ln.Vector3,t._onDeviceMotionChange=t._onDeviceMotionChange.bind(t),t._onScreenOrientationChange=t._onScreenOrientationChange.bind(t),t.filter=new Mn(.98),t.posePredictor=new Rn(.04),t.filterToWorldQ=new ln.Quaternion,t.isFirefoxAndroid=En.isFirefoxAndroid(),t.isIOS=k||U,t.isChromeUsingDegrees=66<=bn,t._isEnabled=!1,t.isIOS?t.filterToWorldQ.setFromAxisAngle(new ln.Vector3(1,0,0),Math.PI/2):t.filterToWorldQ.setFromAxisAngle(new ln.Vector3(1,0,0),-Math.PI/2),t.inverseWorldToScreenQ=new ln.Quaternion,t.worldToScreenQ=new ln.Quaternion,t.originalPoseAdjustQ=new ln.Quaternion,t.originalPoseAdjustQ.setFromAxisAngle(new ln.Vector3(0,0,1),-M.orientation*Math.PI/180),t._setScreenTransform(),En.isLandscapeMode()&&t.filterToWorldQ.multiply(t.inverseWorldToScreenQ),t.resetQ=new ln.Quaternion,t.deviceMotion.on("devicemotion",t._onDeviceMotionChange),t.enable(),t}a(t,e);var i=t.prototype;return i.enable=function(){this.isEnabled()||(this.deviceMotion.enable(),this._isEnabled=!0,M.addEventListener("orientationchange",this._onScreenOrientationChange))},i.disable=function(){this.isEnabled()&&(this.deviceMotion.disable(),this._isEnabled=!1,M.removeEventListener("orientationchange",this._onScreenOrientationChange))},i.isEnabled=function(){return this._isEnabled},i.destroy=function(){this.disable(),this.deviceMotion=null},i.getOrientation=function(){var t,e=this;if(this.deviceMotion.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||(new ln.Quaternion).setFromAxisAngle(new ln.Vector3(0,1,0),-e._alpha),t=this._deviceOrientationQ,(n=new ln.Quaternion).copy(t),n.multiply(this.filterToWorldQ),n.multiply(this.resetQ),n.multiply(this.worldToScreenQ),n.multiplyQuaternions(this.deviceOrientationFixQ,n);var i=Hi(n.x,n.y,n.z,n.w);return Ki(i,i)}if(!(t=this.filter.getOrientation()))return null;var n=this._convertFusionToPredicted(t),i=Hi(n.x,n.y,n.z,n.w);return Ki(i,i)},i._triggerChange=function(){var t=this.getOrientation();t&&(this._prevOrientation?Ji(this._prevOrientation,t)||this.trigger("change",{quaternion:t}):this._prevOrientation=t)},i._convertFusionToPredicted=function(t){this.predictedQ=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);t=new ln.Quaternion;return t.copy(this.filterToWorldQ),t.multiply(this.resetQ),t.multiply(this.predictedQ),t.multiply(this.worldToScreenQ),t},i._onDeviceMotionChange=function(t){var e=t.inputEvent,i=e.deviceorientation,n=e.accelerationIncludingGravity,t=e.adjustedRotationRate||e.rotationRate,e=e.timeStamp/1e3;i?(this._alpha||(this._alpha=i.alpha),this._deviceOrientationQ=this._deviceOrientationQ||new ln.Quaternion,this._deviceOrientationQ.setFromEulerYXZ(i.beta,i.alpha,i.gamma),this._triggerChange()):(this.isFirefoxAndroid&&(e/=1e3),this.accelerometer.set(-n.x,-n.y,-n.z),this.gyroscope.set(t.alpha,t.beta,t.gamma),(this.isIOS||this.isFirefoxAndroid||this.isChromeUsingDegrees)&&this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,e),this.filter.addGyroMeasurement(this.gyroscope,e),this._triggerChange(),this.previousTimestampS=e)},i._onScreenOrientationChange=function(){this._setScreenTransform()},i._setScreenTransform=function(){this.worldToScreenQ.set(0,0,0,1);var t=M.orientation;switch(t){case 0:break;case 90:case-90:case 180:this.worldToScreenQ.setFromAxisAngle(new ln.Vector3(0,0,1),t/-180*Math.PI)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},t}(t);var Fn=function(n){function t(t,e){void 0===e&&(e={});var i=n.call(this)||this;return i.element=t,i._prevQuaternion=null,i._quaternion=null,i.fusionPoseSensor=null,i.options=c({scale:1,threshold:0},e),i._onPoseChange=i._onPoseChange.bind(i),i}a(t,n);var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this.observer||(this.observer=t,this.fusionPoseSensor=new Dn,this.fusionPoseSensor.enable(),this._attachEvent()),this},e.disconnect=function(){return this.observer&&(this._dettachEvent(),this.fusionPoseSensor.disable(),this.fusionPoseSensor.destroy(),this.fusionPoseSensor=null,this.observer=null),this},e.destroy=function(){this.disconnect(),this.element=null,this.options=null,this.axes=null,this._prevQuaternion=null,this._quaternion=null},e._onPoseChange=function(t){if(!this._prevQuaternion)return this._prevQuaternion=ji(t.quaternion),void(this._quaternion=ji(t.quaternion));var n,e,i;qi(this._prevQuaternion,this._quaternion),qi(this._quaternion,t.quaternion),this.observer.change(this,t,(n=this.axes,[(e=this._prevQuaternion,i=this._quaternion,t=sn.getRotationDelta(e,i,an.YAW_DELTA_BY_YAW),sn.getRotationDelta(e,i,an.YAW_DELTA_BY_ROLL)*Math.sin(sn.extractPitchFromQuat(i))+t),(i=this._prevQuaternion,t=this._quaternion,sn.getRotationDelta(i,t,an.PITCH_DELTA))].reduce(function(t,e,i){return n[i]&&(t[n[i]]=e),t},{})))},e._attachEvent=function(){this.fusionPoseSensor.on("change",this._onPoseChange)},e._dettachEvent=function(){this.fusionPoseSensor.off("change",this._onPoseChange)},t}(t),Ln=null,Vn=0,Nn=function(){function t(){if(Vn++,Ln)return Ln;(Ln=this)._onDeviceOrientation=this._onDeviceOrientation.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._spinR=0,this._screenOrientationAngle=0,M.addEventListener("deviceorientation",this._onDeviceOrientation),M.addEventListener("orientationchange",this._onOrientationChange)}var e=t.prototype;return e.getRadian=function(){return this._spinR+gi(this._screenOrientationAngle)},e.unref=function(){0<--Vn||(M.removeEventListener("deviceorientation",this._onDeviceOrientation),M.removeEventListener("orientationchange",this._onOrientationChange),this._spinR=0,this._screenOrientationAngle=0,Ln=null,Vn=0)},e._onDeviceOrientation=function(t){var e;null!==t.beta&&null!==t.gamma&&(e=gi(t.beta),t=gi(t.gamma),this._spinR=Math.atan2(Math.cos(e)*Math.sin(t),Math.sin(e)))},e._onOrientationChange=function(t){M.screen&&M.screen.orientation&&void 0!==M.screen.orientation.angle?this._screenOrientationAngle=screen.orientation.angle:void 0!==M.orientation&&(this._screenOrientationAngle=0<=M.orientation?M.orientation:360+M.orientation)},t}(),kn=function(r){function t(t,e){void 0===e&&(e={});t=r.call(this,t,e)||this;return t._useRotation=!1,t._screenRotationAngle=null,t.setUseRotation(!(!e||!e.useRotation)),t._userDirection=ii.DIRECTION_ALL,t}a(t,r);var e=t.prototype;return e.setUseRotation=function(t){this._useRotation=t,this._screenRotationAngle&&(this._screenRotationAngle.unref(),this._screenRotationAngle=null),this._useRotation&&(this._screenRotationAngle=new Nn)},e.connect=function(t){return this._userDirection=this._direction,this._useRotation&&this._direction&ii.DIRECTION_ALL&&(this._direction=ii.DIRECTION_HORIZONTAL),r.prototype.connect.call(this,t)},e.destroy=function(){this._useRotation&&this._screenRotationAngle&&this._screenRotationAngle.unref(),r.prototype.destroy.call(this)},e.getOffset=function(t,e){if(!1===this._useRotation)return r.prototype.getOffset.call(this,t,e);var i=r.prototype.getOffset.call(this,t,[!0,!0]),n=[0,0],e=this._screenRotationAngle.getRadian(),t=Math.cos(e),e=Math.sin(e);return n[0]=i[0]*t-i[1]*e,n[1]=i[1]*t+i[0]*e,this._userDirection&ii.DIRECTION_HORIZONTAL?this._userDirection&ii.DIRECTION_VERTICAL||(n[1]=0):n[0]=0,n},t}(ci),Un=Pi(0,1,0),zn=function(t){function e(){var e=t.call(this)||this;return e._fusionPoseSensor=new Dn,e._quaternion=ki(),e._fusionPoseSensor.enable(),e._fusionPoseSensor.on("change",function(t){e._quaternion=t.quaternion,e.trigger("change",{isTrusted:!0})}),e}a(e,t);var i=e.prototype;return i.getCombinedQuaternion=function(t){var e,i,n,r,o,s,a=Ui(ki(),Un,-t*vi),h=(s=ki(),o=this._quaternion,s[0]=-o[0],s[1]=-o[1],s[2]=-o[2],s[3]=o[3],s);return e=ki(),n=a,r=(i=h)[0],t=i[1],o=i[2],s=i[3],a=n[0],h=n[1],i=n[2],n=n[3],e[0]=r*n+s*a+t*i-o*h,e[1]=t*n+s*h+o*a-r*i,e[2]=o*n+s*i+r*h-t*a,e[3]=s*n-r*a-t*h-o*i,e},i.destroy=function(){this.off(),this._fusionPoseSensor&&(this._fusionPoseSensor.off(),this._fusionPoseSensor.destroy(),this._fusionPoseSensor=null)},e}(t),Qn="3.5.2",Xn=[-180,180],Wn=[-90,90],Bn=[-180,180],Yn=function(i){function t(t){var e=i.call(this)||this,t=c({element:null,yaw:0,pitch:0,fov:65,showPolePoint:!1,useZoom:!0,useKeyboard:!0,gyroMode:An.YAWPITCH,touchDirection:6,yawRange:Xn,pitchRange:Wn,fovRange:[30,110],aspectRatio:1},t);return e._element=t.element,e._initialFov=t.fov,e._enabled=!1,e._isAnimating=!1,e._deviceQuaternion=null,e._initAxes(t),e.option(t),e}a(t,i);var e=t.prototype;return e.updatePanScale=function(t){void 0===t&&(t={});var e=this.axes.get().fov,t=t.height||parseInt(window.getComputedStyle(this._element).height,10),t=In[0]*e/this._initialFov*320/t;return this.axesPanInput.options.scale=[t,t],this.axes.options.deceleration=.0014*e/110,this},e.option=function(t,e){if(!t)return this._getOptions();if(t&&"string"==typeof t&&void 0===e)return this._getOptions(t);var i={},n=[];return"string"==typeof t?(n.push(t),i[t]=e):(t=t,n=Object.keys(t),i=c({},t)),this._setOptions(this._getValidatedOptions(i)),this._applyOptions(n),this},e.enable=function(){return this._enabled||(this._enabled=!0,this._applyOptions(Object.keys(this.options)),this.updatePanScale()),this},e.disable=function(t){return void 0===t&&(t=!1),this._enabled&&(t||this._resetOrientation(),this.axes.disconnect(),this._enabled=!1),this},e.lookAt=function(t,e){var i=t.yaw,n=t.pitch,r=t.fov,t=this.axes.get(),i=void 0===i?0:i-t.yaw,n=void 0===n?0:n-t.pitch,t=void 0===r?0:r-t.fov;this.axes.options.maximumDuration=1/0,this.axes.setBy({yaw:i,pitch:n,fov:t},e)},e.getYawPitch=function(){var t=this.axes.get();return{yaw:t.yaw,pitch:t.pitch}},e.getFov=function(){return this.axes.get().fov},e.getQuaternion=function(){var t=this.axes.get();return this._deviceQuaternion.getCombinedQuaternion(t.yaw)},e.shouldRenderWithQuaternion=function(){return this.options.gyroMode===An.VR},e.destroy=function(){this.axes&&this.axes.destroy(),this.axesPanInput&&this.axesPanInput.destroy(),this.axesWheelInput&&this.axesWheelInput.destroy(),this.axesTiltMotionInput&&this.axesTiltMotionInput.destroy(),this.axesPinchInput&&this.axesPinchInput.destroy(),this.axesMoveKeyInput&&this.axesMoveKeyInput.destroy(),this._deviceQuaternion&&this._deviceQuaternion.destroy()},e._initAxes=function(t){var e=this,i=this._updateYawRange(t.yawRange,t.fov,t.aspectRatio),n=this._updatePitchRange(t.pitchRange,t.fov,t.showPolePoint),r=t.gyroMode===An.VR;this.axesPanInput=new kn(this._element,{useRotation:r}),this.axesWheelInput=new di(this._element,{scale:-4}),this.axesTiltMotionInput=null,this.axesPinchInput=Q?new li(this._element,{scale:-1}):null,this.axesMoveKeyInput=new fi(this._element,{scale:[-6,6]}),this.axes=new ii({yaw:{range:i,circular:this._isCircular(i),bounce:[0,0]},pitch:{range:n,circular:this._isCircular(n),bounce:[0,0]},fov:{range:t.fovRange,circular:[!1,!1],bounce:[0,0]}},{deceleration:.0014,maximumDuration:1e3},{yaw:t.yaw,pitch:t.pitch,fov:t.fov}).on({hold:function(t){e.axes.options.maximumDuration=1e3,e.trigger("hold",{isTrusted:t.isTrusted})},change:function(t){0!==t.delta.fov&&(e._updateControlScale(t),e.updatePanScale()),e._triggerChange(t)},release:function(t){e._triggerChange(t)},animationEnd:function(t){e.trigger("animationEnd",{isTrusted:t.isTrusted})}})},e._getValidatedOptions=function(t){return t.yawRange&&(t.yawRange=this._getValidYawRange(t.yawRange,t.fov,t.aspectRatio)),t.pitchRange&&(t.pitchRange=this._getValidPitchRange(t.pitchRange,t.fov)),t},e._getOptions=function(t){var e;return"string"==typeof t?e=this.options[t]:0===arguments.length&&(e=this.options),e},e._setOptions=function(t){for(var e in t)this.options[e]=t[e]},e._applyOptions=function(t){var e,i,n,r=this.options,o=this.axes,s=r.gyroMode===An.VR,a=r.gyroMode===An.YAWPITCH,h=s?2&r.touchDirection:r.touchDirection;t.some(function(t){return"showPolePoint"===t||"fov"===t||"aspectRatio"===t||"yawRange"===t||"pitchRange"===t})&&(0<=t.indexOf("fov")&&(o.setTo({fov:r.fov}),this.updatePanScale()),this._updateControlScale()),t.some(function(t){return"fovRange"===t})&&(e=r.fovRange,i=o.get().fov,n=o.get().fov,tn(o.axis.fov.range,e),n<e[0]?n=e[0]:i>e[1]&&(n=e[1]),i!==n&&(o.setTo({fov:n},0),this._updateControlScale(),this.updatePanScale())),t.some(function(t){return"gyroMode"===t})&&X&&(this.axesTiltMotionInput&&(this.axes.disconnect(this.axesTiltMotionInput),this.axesTiltMotionInput.destroy(),this.axesTiltMotionInput=null),this._deviceQuaternion&&(this._deviceQuaternion.destroy(),this._deviceQuaternion=null),s?this._initDeviceQuaternion():a&&(this.axesTiltMotionInput=new Fn(this._element),this.axes.connect(["yaw","pitch"],this.axesTiltMotionInput)),this.axesPanInput.setUseRotation(s)),t.some(function(t){return"useKeyboard"===t})&&(r.useKeyboard?o.connect(["yaw","pitch"],this.axesMoveKeyInput):o.disconnect(this.axesMoveKeyInput)),t.some(function(t){return"useZoom"===t})&&(s=r.useZoom,o.disconnect(this.axesWheelInput),s&&o.connect(["fov"],this.axesWheelInput)),this._togglePinchInputByOption(r.touchDirection,r.useZoom),t.some(function(t){return"touchDirection"===t})&&this._enabled&&this._enableTouch(h)},e._togglePinchInputByOption=function(t,e){this.axesPinchInput&&(this.axes.disconnect(this.axesPinchInput),e&&6===t&&-1===this.axes._inputs.indexOf(this.axesPinchInput)&&this.axes.connect(["fov"],this.axesPinchInput))},e._enableTouch=function(t){this.axesPanInput&&this.axes.disconnect(this.axesPanInput);var e=2&t?"yaw":null,t=4&t?"pitch":null;this.axes.connect([e,t],this.axesPanInput)},e._initDeviceQuaternion=function(){var e=this;this._deviceQuaternion=new zn,this._deviceQuaternion.on("change",function(t){e._triggerChange(t)})},e._getValidYawRange=function(t,e,i){i=this._adjustAspectRatio(i||this.options.aspectRatio||1),i=(e||this.axes.get().fov)*i;return t[1]-t[0]>=i?t:this.options.yawRange||Xn},e._getValidPitchRange=function(t,e){e=e||this.axes.get().fov;return t[1]-t[0]>=e?t:this.options.pitchRange||Wn},e._isCircular=function(t){return t[1]-t[0]<360?[!1,!1]:[!0,!0]},e._updateControlScale=function(t){var e=this.options,i=this.axes.get().fov,n=this._updatePitchRange(e.pitchRange,i,e.showPolePoint),r=this._updateYawRange(e.yawRange,i,e.aspectRatio),i=this.axes.get(),e=i.yaw,i=i.pitch;return tn(this.axes.axis.yaw.range,r),tn(this.axes.axis.pitch.range,n),this.axes.axis.yaw.circular=this._isCircular(r),this.axes.axis.pitch.circular=this._isCircular(n),e<r[0]?e=r[0]:e>r[1]&&(e=r[1]),i<n[0]?i=n[0]:i>n[1]&&(i=n[1]),t&&t.set({yaw:e,pitch:i}),this.axes.setTo({yaw:e,pitch:i},0),this},e._updatePitchRange=function(t,e,i){if(this.options.gyroMode===An.VR)return Bn;var n=t[1]-t[0],e=e/2;return!i||n<180?[t[0]+e,t[1]-e]:t.concat()},e._updateYawRange=function(t,e,i){if(this.options.gyroMode===An.VR)return Xn;if(360<=t[1]-t[0])return t.concat();e=sn.toDegree(Math.atan2(i,1/Math.tan(e/2*vi)));return[t[0]+e,t[1]-e]},e._triggerChange=function(t){var e=this.axes.get(),i=this.options,t={targetElement:i.element,isTrusted:t.isTrusted,yaw:e.yaw,pitch:e.pitch,fov:e.fov,quaternion:null};i.gyroMode===An.VR&&this._deviceQuaternion&&(t.quaternion=this._deviceQuaternion.getCombinedQuaternion(e.yaw)),this.trigger("change",t)},e._adjustAspectRatio=function(t){for(var e=[.52,.54,.563,.57,.584,.59,.609,.67,.702,.72,.76,.78,.82,.92,.97,1,1.07,1.14,1.19,1.25,1.32,1.38,1.4,1.43,1.53,1.62,1.76,1.77,1.86,1.96,2.26,2.3,2.6,3,5,6],i=[.51,.54,.606,.56,.628,.63,.647,.71,.736,.757,.78,.77,.8,.89,.975,1,1.07,1.1,1.15,1.18,1.22,1.27,1.3,1.33,1.39,1.45,1.54,1.55,1.58,1.62,1.72,1.82,1.92,2,2.24,2.3],n=-1,r=0;r<e.length-1;r++)if(e[r]<=t&&t<=e[r+1]){n=r;break}if(-1===n)return t<e[0]?i[0]:i[i[0].length-1];var o=e[n],s=e[n+1],a=i[n],i=i[n+1];return this._lerp(a,i,(t-o)/(s-o))},e._lerp=function(t,e,i){return t+i*(e-t)},e._resetOrientation=function(){var t=this.options;return this.axes.setTo({yaw:t.yaw,pitch:t.pitch,fov:t.fov},0),this},t.VERSION=Qn,t.CONTROL_MODE_VR=1,t.CONTROL_MODE_YAWPITCH=2,t.TOUCH_DIRECTION_ALL=6,t.TOUCH_DIRECTION_YAW=2,t.TOUCH_DIRECTION_PITCH=4,t.TOUCH_DIRECTION_NONE=1,t}(t),Gn=function(t,e){return(Gn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function jn(t,e){function i(){this.constructor=t}Gn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Hn=function(){return(Hn=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};var et="undefined"!=typeof window,z=et?window.navigator.userAgent:"",qn=et&&!!("getComputedStyle"in window),Kn=/MSIE|Trident|Windows Phone|Edge/.test(z),Zn=et&&!!("addEventListener"in document),Jn="width",$n="height";function tr(t,e){return t.getAttribute(e)||""}function er(t){return[].slice.call(t)}function ir(t){return"loading"in t&&"lazy"===t.getAttribute("loading")}function nr(t,e,i){Zn?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}function rr(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):t["on"+e]=null}function or(t,e){var i=t["client"+e]||t["offset"+e];return parseFloat(i||(t=t,((qn?window.getComputedStyle(t):t.currentStyle)||{})[e.toLowerCase()]))||0}function sr(t,e,i){var n=er(t.querySelectorAll(function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var n=Array(t),r=0,e=0;e<i;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)n[r]=o[s];return n}(["["+i+"skip] ["+i+"width]"],e.map(function(t){return["["+i+"skip] "+t,t+"["+i+"skip]","["+i+"width] "+t].join(", ")})).join(", ")));return er(t.querySelectorAll("["+i+"width], "+e.join(", "))).filter(function(t){return-1===n.indexOf(t)})}var ar=[];function hr(t,e){ar.length||nr(window,"resize",cr),t.__PREFIX__=e,ar.push(t),ur(t)}function ur(t,e){void 0===e&&(e="data-");var i,n=t.__PREFIX__||e,r=parseInt(tr(t,""+n+Jn),10)||0,e=parseInt(tr(t,""+n+$n),10)||0;tr(t,n+"fixed")===$n?(i=or(t,"Height")||e,t.style[Jn]=r/e*i+"px"):(i=or(t,"Width")||r,t.style[$n]=e/r*i+"px")}function cr(){ar.forEach(function(t){ur(t)})}for(var z=function(o){function t(t,e){void 0===e&&(e={});var i,n,r=o.call(this)||this;return r.isReady=!1,r.isPreReady=!1,r.hasDataSize=!1,r.hasLoading=!1,r.isSkip=!1,r.onCheck=function(t){r.clear(),t&&"error"===t.type&&r.onError(r.element);t=!r.hasDataSize&&!r.hasLoading;r.onReady(t)},r.options=Hn({prefix:"data-"},e),r.element=t,r.hasDataSize=(i=t,void 0===(e=r.options.prefix)&&(e="data-"),!!i.getAttribute(e+"width")),r.hasLoading=ir(t),r.isSkip=(t=r.element,void 0===n&&(n="data-"),!!t.getAttribute(n+"skip")),r}jn(t,o);var e=t.prototype;return e.check=function(){return this.isSkip||!this.checkElement()?(this.onAlreadyReady(!0),!1):(this.hasDataSize&&hr(this.element,this.options.prefix),(this.hasDataSize||this.hasLoading)&&this.onAlreadyPreReady(),!0)},e.addEvents=function(){var e=this,i=this.element;this.constructor.EVENTS.forEach(function(t){nr(i,t,e.onCheck)})},e.clear=function(){var e=this,i=this.element;this.constructor.EVENTS.forEach(function(t){rr(i,t,e.onCheck)}),this.removeAutoSizer()},e.destroy=function(){this.clear(),this.off()},e.removeAutoSizer=function(){var t,e,i;this.hasDataSize&&(i=this.options.prefix,t=this.element,e=i,(i=ar.indexOf(t))<0||(e=tr(t,e+"fixed"),delete t.__PREFIX__,t.style[e===$n?Jn:$n]="",ar.splice(i,1),ar.length||rr(window,"resize",cr)))},e.onError=function(t){this.trigger("error",{element:this.element,target:t})},e.onPreReady=function(){this.isPreReady||(this.isPreReady=!0,this.trigger("preReady",{element:this.element,hasLoading:this.hasLoading,isSkip:this.isSkip}))},e.onReady=function(t){this.isReady||(t&&(this.isPreReady=!0),this.removeAutoSizer(),this.isReady=!0,this.trigger("ready",{element:this.element,withPreReady:t,hasLoading:this.hasLoading,isSkip:this.isSkip}))},e.onAlreadyError=function(t){var e=this;setTimeout(function(){e.onError(t)})},e.onAlreadyPreReady=function(){var t=this;setTimeout(function(){t.onPreReady()})},e.onAlreadyReady=function(t){var e=this;setTimeout(function(){e.onReady(t)})},t.EVENTS=[],t}(t),lr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}jn(e,t);var i=e.prototype;return i.setHasLoading=function(t){this.hasLoading=t},i.check=function(){return this.isSkip?(this.onAlreadyReady(!0),!1):(this.hasDataSize?(hr(this.element,this.options.prefix),this.onAlreadyPreReady()):this.trigger("requestChildren"),!0)},i.checkElement=function(){return!0},i.destroy=function(){this.clear(),this.trigger("requestDestroy"),this.off()},i.onAlreadyPreReady=function(){t.prototype.onAlreadyPreReady.call(this),this.trigger("reqeustReadyChildren")},e.EVENTS=[],e}(z),et=function(i){function t(t){void 0===t&&(t={});var e=i.call(this)||this;return e.readyCount=0,e.preReadyCount=0,e.totalCount=0,e.totalErrorCount=0,e.isPreReadyOver=!0,e.elementInfos=[],e.options=Hn({loaders:{},prefix:"data-"},t),e}jn(t,i);var e=t.prototype;return e.check=function(t){var o=this,i=this.options.prefix;this.clear(),this.elementInfos=er(t).map(function(t,r){var e=o.getLoader(t,{prefix:i});return e.check(),e.on("error",function(t){o.onError(r,t.target)}).on("preReady",function(t){var e=o.elementInfos[r];e.hasLoading=t.hasLoading,e.isSkip=t.isSkip;t=o.checkPreReady(r);o.onPreReadyElement(r),t&&o.onPreReady()}).on("ready",function(t){var e=t.withPreReady,i=t.hasLoading,n=t.isSkip,t=o.elementInfos[r];t.hasLoading=i,t.isSkip=n;t=e&&o.checkPreReady(r),n=o.checkReady(r);e&&o.onPreReadyElement(r),o.onReadyElement(r),t&&o.onPreReady(),n&&o.onReady()}),{loader:e,element:t,hasLoading:!1,hasError:!1,isPreReady:!1,isReady:!1,isSkip:!1}});t=this.elementInfos.length;return(this.totalCount=t)||setTimeout(function(){o.onPreReady(),o.onReady()}),this},e.getTotalCount=function(){return this.totalCount},e.isPreReady=function(){return this.elementInfos.every(function(t){return t.isPreReady})},e.isReady=function(){return this.elementInfos.every(function(t){return t.isReady})},e.hasError=function(){return 0<this.totalErrorCount},e.clear=function(){this.isPreReadyOver=!1,this.totalCount=0,this.preReadyCount=0,this.readyCount=0,this.totalErrorCount=0,this.elementInfos.forEach(function(t){!t.isReady&&t.loader&&t.loader.destroy()}),this.elementInfos=[]},e.destroy=function(){this.clear(),this.off()},e.getLoader=function(e,t){var i=this,n=e.tagName.toLowerCase(),r=this.options.loaders,o=Object.keys(r);if(r[n])return new r[n](e,t);var s=new lr(e,t),a=er(e.querySelectorAll(o.join(", ")));s.setHasLoading(a.some(ir));var h=!1,u=this.clone().on("error",function(t){s.onError(t.target)}).on("ready",function(){s.onReady(h)});return s.on("requestChildren",function(){var t=sr(e,o,i.options.prefix);u.check(t).on("preReady",function(t){(h=t.isReady)||s.onPreReady()})}).on("reqeustReadyChildren",function(){u.check(a)}).on("requestDestroy",function(){u.destroy()}),s},e.clone=function(){return new t(Hn({},this.options))},e.checkPreReady=function(t){return this.elementInfos[t].isPreReady=!0,++this.preReadyCount,!(this.preReadyCount<this.totalCount)},e.checkReady=function(t){return this.elementInfos[t].isReady=!0,++this.readyCount,!(this.readyCount<this.totalCount)},e.onError=function(t,e){var i=this.elementInfos[t];i.hasError=!0,this.trigger("error",{element:i.element,index:t,target:e,errorCount:this.getErrorCount(),totalErrorCount:++this.totalErrorCount})},e.onPreReadyElement=function(t){var e=this.elementInfos[t];this.trigger("preReadyElement",{element:e.element,index:t,preReadyCount:this.preReadyCount,readyCount:this.readyCount,totalCount:this.totalCount,isPreReady:this.isPreReady(),isReady:this.isReady(),hasLoading:e.hasLoading,isSkip:e.isSkip})},e.onPreReady=function(){this.isPreReadyOver=!0,this.trigger("preReady",{readyCount:this.readyCount,totalCount:this.totalCount,isReady:this.isReady(),hasLoading:this.hasLoading()})},e.onReadyElement=function(t){var e=this.elementInfos[t];this.trigger("readyElement",{index:t,element:e.element,hasError:e.hasError,errorCount:this.getErrorCount(),totalErrorCount:this.totalErrorCount,preReadyCount:this.preReadyCount,readyCount:this.readyCount,totalCount:this.totalCount,isPreReady:this.isPreReady(),isReady:this.isReady(),hasLoading:e.hasLoading,isPreReadyOver:this.isPreReadyOver,isSkip:e.isSkip})},e.onReady=function(){this.trigger("ready",{errorCount:this.getErrorCount(),totalErrorCount:this.totalErrorCount,totalCount:this.totalCount})},e.getErrorCount=function(){return this.elementInfos.filter(function(t){return t.hasError}).length},e.hasLoading=function(){return this.elementInfos.some(function(t){return t.hasLoading})},t}(t),dr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return jn(e,t),e.prototype.checkElement=function(){var t=this.element,e=t.getAttribute("src");return t.complete&&e?(t.naturalWidth||this.onAlreadyError(t),!1):(this.addEvents(),Kn&&t.setAttribute("src",e),!0)},e.EVENTS=["load","error"],e}(z),fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return jn(e,t),e.prototype.checkElement=function(){var t=this.element;return!(1<=t.readyState)&&(t.error?(this.onAlreadyError(t),!1):(this.addEvents(),!0))},e.EVENTS=["loadedmetadata","error"],e}(z),pr=function(e){function t(t){return void 0===t&&(t={}),e.call(this,Hn({loaders:{img:dr,video:fr}},t))||this}return jn(t,e),t}(et),mr={0:"NO_ERROR",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",37442:"CONTEXT_LOST_WEBGL"},vr=null,gr=function(){function e(){}return e.createShader=function(t,e,i){e=t.createShader(e);return t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)?e:(console.error(t.getShaderInfoLog(e)),null)},e.createProgram=function(t,e,i){var n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.deleteShader(e),t.deleteShader(i),t.getProgramParameter(n,t.LINK_STATUS)?n:(t.deleteProgram(n),null)},e.initBuffer=function(t,e,i,n,r){var o=t.createBuffer();return t.bindBuffer(e,o),t.bufferData(e,i,t.STATIC_DRAW),o&&(o.itemSize=n,o.numItems=i.length/n),void 0!==r&&(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,o.itemSize,t.FLOAT,!1,0,0)),o},e.getWebglContext=function(t,e){var i,n,r=null,o=c({preserveDrawingBuffer:!1,antialias:!1},e);function s(t){return t.statusMessage}t.addEventListener("webglcontextcreationerror",s);try{for(var a=d(["webgl","experimental-webgl","webkit-3d","moz-webgl"]),h=a.next();!h.done;h=a.next()){var u=h.value;try{r=t.getContext(u,o)}catch(t){}if(r)break}}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return t.removeEventListener("webglcontextcreationerror",s),r},e.createTexture=function(t,e){var i=t.createTexture();return t.bindTexture(e,i),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(e,null),i},e.isWebGLAvailable=function(){var t;return null===vr&&(t=document.createElement("canvas"),t=e.getWebglContext(t),vr=!!t,!t||(t=t.getExtension("WEBGL_lose_context"))&&t.loseContext()),!!vr},e.isStableWebGL=function(){var t,e=O(),i=!0;return"android"!==e.os.name||((t=parseFloat(e.os.version))<=4.3&&1<=t||4.4===t&&"chrome"!==e.browser.name)&&(i=!1),i},e.getErrorNameFromWebGLErrorCode=function(t){return t in mr?mr[t]:"UNKNOWN_ERROR"},e.texImage2D=function(t,e,i){try{t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)}catch(t){console.error("WebGLUtils.texImage2D error:",t)}},e.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},e}(),et=O(),_r="ie"===et.browser.name&&11===et.browser.majorVersion,yr={ERROR:"error"},xr=function(e){function t(){var t=e.call(this)||this;return t._forceDimension=null,t._pixelCanvas=null,t._pixelContext=null,t}a(t,e);var i=t.prototype;return i.render=function(t){var e=t.gl,i=t.shaderProgram,n=t.indexBuffer,r=t.mvMatrix,t=t.pMatrix;e.uniformMatrix4fv(i.pMatrixUniform,!1,t),e.uniformMatrix4fv(i.mvMatrixUniform,!1,r),n&&e.drawElements(e.TRIANGLES,n.numItems,e.UNSIGNED_SHORT,0)},i.getDimension=function(t){return{width:t.naturalWidth||t.videoWidth,height:t.naturalHeight||t.videoHeight}},i.updateShaderData=function(t){},i._initPixelSource=function(t,e){var i;void 0===e&&(e=null),(_r&&t instanceof HTMLVideoElement||e)&&(t=(i=e||this.getDimension(t)).width,i=i.height,this._pixelCanvas=document.createElement("canvas"),this._pixelCanvas.width=t,this._pixelCanvas.height=i,this._pixelContext=this._pixelCanvas.getContext("2d")),this._forceDimension=e},i._getPixelSource=function(t){if(!this._pixelCanvas)return t;var e=this.getDimension(t),i=this._forceDimension||e;return this._pixelCanvas.width!==i.width&&(this._pixelCanvas.width=i.width),this._pixelCanvas.height!==i.height&&(this._pixelCanvas.height=i.height),this._forceDimension?this._pixelContext.drawImage(t,0,0,e.width,e.height,0,0,i.width,i.height):this._pixelContext.drawImage(t,0,0),this._pixelCanvas},i._extractTileConfig=function(t){return(Array.isArray(t.tileConfig)?t.tileConfig:Array.apply(void 0,f(Array(6))).map(function(){return t.tileConfig})).map(function(t){return c({flipHorizontal:!1,rotation:0},t)})},i._triggerError=function(t){console.error("Renderer Error:",t),this.trigger(yr.ERROR,{message:"string"==typeof t?t:t.message})},t.EVENTS=yr,t}(t),wr=function(t){function u(){return null!==t&&t.apply(this,arguments)||this}a(u,t);var e=u.prototype;return u.extractOrder=function(t){return t.order||"RLUDBF"},e.getVertexPositionData=function(){return u._VERTEX_POSITION_DATA=null!==u._VERTEX_POSITION_DATA?u._VERTEX_POSITION_DATA:[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]},e.getIndexData=function(){if(u._INDEX_DATA)return u._INDEX_DATA;for(var t=[],e=this.getVertexPositionData(),i=0;i<e.length/3;i+=4)t.push(i,i+2,i+1,i,i+3,i+2);return u._INDEX_DATA=t},e.getTextureCoordData=function(t){var e=this,i=t.image,t=t.imageConfig,n=u.extractOrder(t),h=this.getVertexPositionData(),r=this._extractTileConfig(t),o=t.trim;return"BFUDRL".split("").map(function(t){return r[n.indexOf(t)]}).map(function(t,e){for(var i=Math.floor(t.rotation/90),n=t.flipHorizontal?[0,1,2,3]:[1,0,3,2],r=0;r<Math.abs(i);r++)t.flipHorizontal&&0<i||!t.flipHorizontal&&i<0?n.push(n.shift()):n.unshift(n.pop());for(var o=h.slice(12*e,12*e+12),s=[],a=0;a<4;a++)s[n[a]]=o.splice(0,3);return s}).map(function(t){return e._shrinkCoord({image:i,faceCoords:t,trim:o})}).reduce(function(t,e){return f(t,e.reduce(function(t,e){return f(t,e)},[]))},[])},e.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n  vVertexDirectionVector = aTextureCoord;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},e.getFragmentShaderSource=function(){return"\nprecision highp float;\nuniform samplerCube uSampler;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n  gl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n}"},e.updateTexture=function(t,e,i){var i=u.extractOrder(i),n={};i.split("").forEach(function(t,e){n[t]=e});try{if(e instanceof Array)for(var r=0;r<6;r++){var o=n["RLUDBF"[r]];gr.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,e[o])}else for(var s=this.getMaxCubeMapTextureSize(t,e),r=0;r<6;r++){var o=n["RLUDBF"[r]],a=this.extractTileFromImage(e,o,s);gr.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,a)}}catch(t){this._triggerError(t)}},e.bindTexture=function(t,e,i,n){t.bindTexture(t.TEXTURE_CUBE_MAP,e),this.updateTexture(t,i,n)},e.getSourceTileSize=function(t){var e=this.getDimension(t),i=e.width,t=e.height,e=i/t,i=e==1/6?i:6==e?t:e==2/3?i/2:i/3;return i},e.extractTileFromImage=function(t,e,i){var n=this.getDimension(t).width,r=this.getSourceTileSize(t),o=document.createElement("canvas");o.width=i,o.height=i;var s=o.getContext("2d"),a=n/r,n=r*e%(r*a),a=Math.floor(e/a)*r;return s.drawImage(t,n,a,r,r,0,0,i,i),o},e.getMaxCubeMapTextureSize=function(t,e){var i=O(),n=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),r=this.getSourceTileSize(e);if("ie"===i.browser.name&&11===i.browser.majorVersion&&!sn.isPowerOfTwo(r))for(var o=1;o<n;o*=2)if(!(o<r)){r=o;break}return"ios"===i.os.name&&(9===(i=i.os.majorVersion)&&(r=1024),8===i&&(r=512)),Math.min(n,r)},e._shrinkCoord=function(t){var e=t.image,n=t.faceCoords,i=1-t.trim*(2/(Array.isArray(e)?this.getDimension(e[0]).width:this.getSourceTileSize(e))),r=[0,1,2].map(function(e){var i=sn.sign(n[0][e]);return n.some(function(t){return sn.sign(t[e])!==i})}).map(function(t){return t?i:1});return n.map(function(t){return t.map(function(t,e){return t*r[e]})})},u._VERTEX_POSITION_DATA=null,u._INDEX_DATA=null,u}(xr),Er=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}a(e,t);var i=e.prototype;return i.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n  vTextureCoord = aTextureCoord;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},i.getFragmentShaderSource=function(){return"\n#define PI 3.14159265359\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool uIsEAC;\nconst vec2 OPERATE_COORDS_RANGE = vec2(-1.0, 1.0);\nconst vec2 TEXTURE_COORDS_RANGE = vec2(0.0, 1.0);\n// vector type is used for initializing values instead of array.\nconst vec4 TEXTURE_DIVISION_X = vec4(0.0, 1.0 / 3.0, 2.0 / 3.0, 1.0);\nconst vec3 TEXTURE_DIVISION_Y = vec3(0.0, 1.0 / 2.0, 1.0);\nconst float EAC_CONST = 2.0 / PI;\nfloat scale(vec2 domainRange, vec2 targetRange, float val) {\n  float unit = 1.0 / (domainRange[1] - domainRange[0]);\n  return targetRange[0] + (targetRange[1] - targetRange[0]) * (val - domainRange[0]) * unit;\n}\nvoid main(void) {\n  float transformedCoordX;\n  float transformedCoordY;\n\n  if (uIsEAC) {\n    vec2 orgTextureRangeX;\n    vec2 orgTextureRangeY;\n\n    // Apply EAC transform\n    if (vTextureCoord.s >= TEXTURE_DIVISION_X[2]) {\n      orgTextureRangeX = vec2(TEXTURE_DIVISION_X[2], TEXTURE_DIVISION_X[3]);\n    } else if (vTextureCoord.s >= TEXTURE_DIVISION_X[1]) {\n      orgTextureRangeX = vec2(TEXTURE_DIVISION_X[1], TEXTURE_DIVISION_X[2]);\n    } else {\n      orgTextureRangeX = vec2(TEXTURE_DIVISION_X[0], TEXTURE_DIVISION_X[1]);\n    }\n\n    if (vTextureCoord.t >= TEXTURE_DIVISION_Y[1]) {\n      orgTextureRangeY = vec2(TEXTURE_DIVISION_Y[1], TEXTURE_DIVISION_Y[2]);\n    } else {\n      orgTextureRangeY = vec2(TEXTURE_DIVISION_Y[0], TEXTURE_DIVISION_Y[1]);\n    }\n\n    // scaling coors by the coordinates following the range from -1.0 to 1.0.\n    float px = scale(orgTextureRangeX, OPERATE_COORDS_RANGE, vTextureCoord.s);\n    float py = scale(orgTextureRangeY, OPERATE_COORDS_RANGE, vTextureCoord.t);\n\n    float qu = EAC_CONST * atan(px) + 0.5;\n    float qv = EAC_CONST * atan(py) + 0.5;\n\n    // re-scaling coors by original coordinates ranges\n    transformedCoordX = scale(TEXTURE_COORDS_RANGE, orgTextureRangeX, qu);\n    transformedCoordY = scale(TEXTURE_COORDS_RANGE, orgTextureRangeY, qv);\n  } else {\n    // normal cubemap\n    transformedCoordX = vTextureCoord.s;\n    transformedCoordY = vTextureCoord.t;\n  }\n\n  gl_FragColor = texture2D(uSampler, vec2(transformedCoordX, transformedCoordY));\n}"},i.getVertexPositionData=function(){return this._vertices||(this._vertices=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]),this._vertices},i.getIndexData=function(){var i=this;return function(){for(var t=[],e=0;e<i._vertices.length/3;e+=4)t.push(e,e+1,e+2,e,e+2,e+3);return t}()},i.getTextureCoordData=function(t){for(var i=this,e=t.image,t=t.imageConfig,n=this.getDimension(e),r=t.trim,o=t.order||"RLUDFB",s=[],a=1;0<=a;a--)for(var h=0;h<3;h++){var u=[h/3,a/2,(h+1)/3,a/2,(h+1)/3,(a+1)/2,h/3,(a+1)/2];s.push(u)}var c=this._extractTileConfig(t),s=s.map(function(t){return i._shrinkCoord(t,n,r)}).map(function(t,e){return i._transformCoord(t,c[e])});return"BFUDRL".split("").map(function(t){return o.indexOf(t)}).map(function(t){return s[t]}).reduce(function(t,e){return t.concat(e)},[])},i.updateTexture=function(t,e){gr.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},i.bindTexture=function(t,e,i){var n=this.getDimension(i),r=n.width,o=n.height,n=Math.max(r,o),o=gr.getMaxTextureSize(t);o<n?this._triggerError("Image width("+r+") exceeds device limit("+o+"))"):(this._initPixelSource(i),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,i))},i._transformCoord=function(t,e){t=t.slice();return e.flipHorizontal&&(t=this._flipHorizontalCoord(t)),e.rotation&&(t=this._rotateCoord(t,e.rotation)),t},i._shrinkCoord=function(t,e,i){var n=e.width,e=i*(1/e.height),n=i*(1/n);return[t[0]+n,t[1]+e,t[2]-n,t[3]+e,t[4]-n,t[5]-e,t[6]+n,t[7]-e]},i._rotateCoord=function(t,e){var i,e=Math.floor(e/90)%4;if(0==e)return t;return 0<e?(i=t.splice(0,2*e),t.concat(i)):(i=t.splice(2*(4+e),2*-e)).concat(t)},i._flipHorizontalCoord=function(t){return[t[2],t[3],t[0],t[1],t[6],t[7],t[4],t[5]]},e}(xr),Tr={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,FAIL_BIND_TEXTURE:13,INVALID_RESOURCE:14,RENDERING_CONTEXT_LOST:15},Rr={READY:"ready",VIEW_CHANGE:"viewChange",ANIMATION_END:"animationEnd",ERROR:"error"},br={EQUIRECTANGULAR:"equirectangular",CUBEMAP:"cubemap",CUBESTRIP:"cubestrip",PANORAMA:"panorama",STEREOSCOPIC_EQUI:"stereoequi"},Cr={TOP_BOTTOM:"3dv",LEFT_RIGHT:"3dh",NONE:""},Pr=-.5*Math.PI,Ir=[],Ar=[],Sr=[],Or=0;Or<=60;Or++)for(var Mr=(Or/60-.5)*Math.PI,Dr=Math.sin(Mr),Fr=Math.cos(Mr),Lr=0;Lr<=60;Lr++){var Vr=2*(Lr/60-.5)*Math.PI+Pr,Nr=Math.sin(Vr),kr=Math.cos(Vr)*Fr,Ur=Dr,zr=Nr*Fr,Vr=Lr/60,Nr=Or/60;Ir.push(Vr,Nr),Ar.push(2*kr,2*Ur,2*zr),60!==Lr&&60!==Or&&(zr=(Ur=61*Or+Lr)+60+1,Sr.push(Ur,zr,Ur+1,zr,zr+1,Ur+1))}var Qr=function(o){function t(t){var e=o.call(this)||this;return e._stereoFormat=t,e}a(t,o);var e=t.prototype;return e.render=function(t){var e,i,n=t.gl,r=t.shaderProgram;switch(this._stereoFormat){case Cr.TOP_BOTTOM:e=[1,.5,0,0],i=[1,.5,0,.5];break;case Cr.LEFT_RIGHT:e=[.5,1,0,0],i=[.5,1,.5,0];break;default:e=[1,1,0,0],i=[1,1,0,0]}r=n.getUniformLocation(r,"uTexScaleOffset");n.uniform4fv(r,f(e,i)),o.prototype.render.call(this,t)},e.getVertexPositionData=function(){return t._VERTEX_POSITION_DATA},e.getIndexData=function(){return t._INDEX_DATA},e.getTextureCoordData=function(){return t._TEXTURE_COORD_DATA},e.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform float uEye;\nuniform vec4 uTexScaleOffset[2];\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n  vec4 scaleOffset = uTexScaleOffset[int(uEye)];\n  vTextureCoord = aTextureCoord.xy * scaleOffset.xy + scaleOffset.zw;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},e.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord.st);\n}"},e.updateTexture=function(t,e){gr.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},e.bindTexture=function(t,e,i){var n=this.getDimension(i),r=n.width,o=n.height,n=Math.max(r,o),o=gr.getMaxTextureSize(t);o<n?this._triggerError("Image width("+r+") exceeds device limit("+o+"))"):(this._initPixelSource(i),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,i))},t._VERTEX_POSITION_DATA=Ar,t._TEXTURE_COORD_DATA=Ir,t._INDEX_DATA=Sr,t}(xr),Xr=[],Wr=[],Br=[],Yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}a(e,t);var i=e.prototype;return i.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},i.getIndexData=function(){return e._INDEX_DATA},i.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},i.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n  vTextureCoord = aTextureCoord;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},i.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}"},i.updateTexture=function(t,e){gr.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},i.bindTexture=function(t,e,i){var n,r=this.getDimension(i),o=r.width,s=r.height,a=Math.max(o,s),r=gr.getMaxTextureSize(t);r<a&&(this._triggerError("Image width("+o+") exceeds device texture limit("+r+"))"),n=s<o?{width:r,height:r*s/o}:{width:r*o/s,height:r}),this._initPixelSource(i,n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,i)},i.updateShaderData=function(t){var e,i,n,r=t.imageAspectRatio,t=void 0===r?6:r,r=t<1?(i=!0,1/t):(i=!1,t);r=6<=r?(t=360/r,n=2*Math.PI,Math.tan(t/2*vi)):(n=r,.5),Xr.length=0,Wr.length=0,Br.length=0;for(var o=[-r,r],s=Math.PI/2+(2*Math.PI-n)/2,a=0,h=o.length;a<h;a++)for(e=0;e<=60;e++){var u=s+e/60*n,c=Math.cos(u),l=o[a],d=Math.sin(u),f=void 0,u=void 0,u=i?(f=1-a,e/60):(f=e/60,a);Xr.push(f,u),Wr.push(c,l,d),0===a&&e<60&&(d=e+60+1,Br.push(e,d,e+1,d,d+1,e+1))}},e._VERTEX_POSITION_DATA=Wr,e._TEXTURE_COORD_DATA=Xr,e._INDEX_DATA=Br,e}(xr),Gr="vrdisplaypresentchange",jr=[0,0,.5,1],Hr=[.5,0,.5,1],qr="left",Kr="right",Zr=function(){function t(){var e=this;this.destroy=function(){var t=e._vrDisplay;e.removeEndCallback(e.destroy),t&&t.isPresenting&&t.exitPresent(),e._clear()},this._frameData=new window.VRFrameData,this._clear()}var e=t.prototype;return Object.defineProperty(e,"context",{get:function(){return this._vrDisplay},enumerable:!1,configurable:!0}),e.canRender=function(){return Boolean(this._vrDisplay)},e.beforeRender=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null)},e.afterRender=function(){this._vrDisplay.submitFrame()},e.getEyeParams=function(t){var e=this._vrDisplay,i=.5*t.drawingBufferWidth,n=t.drawingBufferHeight,r=this._frameData;e.getFrameData(r);t=r.leftViewMatrix,e=r.rightViewMatrix;return Ti(t,t,this._yawOffset),Ti(e,e,this._yawOffset),[{viewport:[0,0,i,n],mvMatrix:t,pMatrix:r.leftProjectionMatrix},{viewport:[i,0,i,n],mvMatrix:e,pMatrix:r.rightProjectionMatrix}]},e.isPresenting=function(){return Boolean(this._vrDisplay&&this._vrDisplay.isPresenting)},e.addEndCallback=function(t){window.addEventListener(Gr,t)},e.removeEndCallback=function(t){window.removeEventListener(Gr,t)},e.requestPresent=function(n){var r=this;return navigator.getVRDisplays().then(function(t){var i=t.length&&t[0];return i?i.capabilities.canPresent?i.requestPresent([{source:n}]).then(function(){var t=i.getEyeParameters(qr),e=i.getEyeParameters(Kr);n.width=2*Math.max(t.renderWidth,e.renderWidth),n.height=Math.max(t.renderHeight,e.renderHeight),r._setDisplay(i)}):u.reject(new Error("Display lacking capability to present.")):u.reject(new Error("No displays available."))})},e.setYawOffset=function(t){this._yawOffset=t},e._setDisplay=function(t){t=(this._vrDisplay=t).getLayers();t.length&&(t=t[0],this._leftBounds=t.leftBounds,this._rightBounds=t.rightBounds),this.addEndCallback(this.destroy)},e._clear=function(){this._vrDisplay=null,this._leftBounds=jr,this._rightBounds=Hr,this._yawOffset=0},t}();function Jr(t,e){var i,n;if("object"==typeof e?(i=e.src,n=e.type):"string"==typeof e&&(i=e),!i)return!1;e=document.createElement("source");e.src=i,n&&(e.type=n),t.appendChild(e)}var $r=function(){function t(t){var e=this;void 0===t&&(t={}),this.destroy=function(){var t=e._xrSession;e.removeEndCallback(e.destroy),t&&t.end().then(function(){},function(){}),e._clear()},this._clear(),this._options=t}var e=t.prototype;return Object.defineProperty(e,"context",{get:function(){return this._xrSession},enumerable:!1,configurable:!0}),e.canRender=function(t){t=t.getViewerPose(this._xrRefSpace);return Boolean(t)},e.beforeRender=function(t,e){e=e.session.renderState.baseLayer;t.bindFramebuffer(t.FRAMEBUFFER,e.framebuffer)},e.afterRender=function(){},e.getEyeParams=function(t,e){var n=this,i=e.session,e=e.getViewerPose(this._xrRefSpace);if(!e)return null;var r=i.renderState.baseLayer;return e.views.map(function(t){var e=r.getViewport(t),i=t.transform.inverse.matrix;return U&&Ei(i,i,180*vi),Ti(i,i,n._yawOffset),{viewport:[e.x,e.y,e.width,e.height],mvMatrix:i,pMatrix:t.projectionMatrix}})},e.isPresenting=function(){return this._presenting},e.addEndCallback=function(t){var e;null!==(e=this._xrSession)&&void 0!==e&&e.addEventListener("end",t)},e.removeEndCallback=function(t){var e;null!==(e=this._xrSession)&&void 0!==e&&e.removeEventListener("end",t)},e.requestPresent=function(t,r){return i(this,void 0,void 0,function(){var e,i,n=this;return o(this,function(t){switch(t.label){case 0:return e=function(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.forEach(function(i){Object.keys(i).forEach(function(t){var e=i[t];Array.isArray(n[t])&&Array.isArray(e)?n[t]=f(n[t],e):n[t]=e})}),n}({requiredFeatures:["local"]},this._options),(i=r.getContextAttributes())&&!0!==i.xrCompatible?[4,r.makeXRCompatible()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2,navigator.xr.requestSession("immersive-vr",e).then(function(e){var i=new window.XRWebGLLayer(e,r);return e.updateRenderState({baseLayer:i}),e.requestReferenceSpace("local").then(function(t){n._setSession(e,i,t)})})]}})})},e.setYawOffset=function(t){this._yawOffset=t},e._setSession=function(t,e,i){this._xrSession=t,this._xrLayer=e,this._xrRefSpace=i,this._presenting=!0,this.addEndCallback(this.destroy)},e._clear=function(){this._xrSession=null,this._xrLayer=null,this._xrRefSpace=null,this._presenting=!1,this._yawOffset=0,this._options={}},t}(),to=function(){function t(){var n=this;this._onLoop=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n._callback.apply(n,f(t)),n._rafId=n._context.requestAnimationFrame(n._onLoop)},this._onLoopNextTick=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=performance.now();n._callback.apply(n,f(t));i=performance.now()-i;0<=n._rafTimer&&(clearTimeout(n._rafTimer),n._rafTimer=-1),i<16?n._rafId=n._context.requestAnimationFrame(n._onLoop):n._rafTimer=window.setTimeout(n._onLoop,0)},this._callback=null,this._context=window,this._rafId=-1,this._rafTimer=-1}var e=t.prototype;return e.setCallback=function(t){this._callback=t},e.setContext=function(t){this._context=t},e.start=function(){var t=this._context,e=this._callback;t&&e&&(0<=this._rafId||0<=this._rafTimer||(this._rafId=U?t.requestAnimationFrame(this._onLoopNextTick):t.requestAnimationFrame(this._onLoop)))},e.stop=function(){0<=this._rafId&&this._context.cancelAnimationFrame(this._rafId),0<=this._rafTimer&&clearTimeout(this._rafTimer),this._rafId=-1,this._rafTimer=-1},t}(),eo=br,io=B||1;2<io&&(io=2);var no={BIND_TEXTURE:"bindTexture",IMAGE_LOADED:"imageLoaded",ERROR:"error",RENDERING_CONTEXT_LOST:"renderingContextLost",RENDERING_CONTEXT_RESTORE:"renderingContextRestore"},ro={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,RENDERER_ERROR:13},oo=function(s){function t(t,e,i,n,r,o){var l=s.call(this)||this;return l.textureCoordBuffer=null,l.vertexBuffer=null,l.indexBuffer=null,l.exitVR=function(){var t=l._vr,e=l.context,i=l._animator;t&&(t.removeEndCallback(l.exitVR),t.destroy(),l._vr=null,k&&l._restoreStyle(),l.updateViewportDimensions(l.width,l.height),l._updateViewport(),e.bindFramebuffer(e.FRAMEBUFFER,null),l._bindBuffers(),l._shouldForceDraw=!0,i.stop(),i.setContext(window),i.setCallback(l._render.bind(l)),i.start())},l._renderStereo=function(t,e){var i,n,r=l._vr,o=l.context,s=r.getEyeParams(o,e);if(s){r.beforeRender(o,e);try{for(var a=d([0,1]),h=a.next();!h.done;h=a.next()){var u=h.value,c=s[u];l.mvMatrix=c.mvMatrix,l.pMatrix=c.pMatrix,o.viewport.apply(o,f(c.viewport)),o.uniform1f(l.shaderProgram.uEye,u),l._bindBuffers(),l._draw()}}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}r.afterRender()}},l._onFirstVRFrame=function(t,e){var i,n=l._vr,r=l.context,o=l._animator;n.canRender(e)&&(i=Pi(0,0,-1),r=n.getEyeParams(r,e)[0],e=yi(_i(),r.mvMatrix),r=yi(_i(),r.pMatrix),e=xi(_i(),e),r=xi(_i(),r),r=Mi(bi(),i,r),Mi(r,r,e),0!==(r=sn.yawOffsetBetween(r,Pi(0,0,1)))&&(n.setYawOffset(r),o.setCallback(l._renderStereo)))},l.sphericalConfig=r,l.fieldOfView=r.fieldOfView,l.width=e,l.height=i,l._lastQuaternion=null,l._lastYaw=null,l._lastPitch=null,l._lastFieldOfView=null,l.pMatrix=wi(),l.mvMatrix=wi(),Ri(l.pMatrix,gi(l.fieldOfView),e/i,.1,100),l.textureCoordBuffer=null,l.vertexBuffer=null,l.indexBuffer=null,l.canvas=l._initCanvas(e,i),l._setDefaultCanvasStyle(),l._wrapper=null,l._wrapperOrigStyle=null,l._renderingContextAttributes=o,l._image=null,l._imageConfig=null,l._imageIsReady=!1,l._shouldForceDraw=!1,l._keepUpdate=!1,l._onContentLoad=l._onContentLoad.bind(l),l._onContentError=l._onContentError.bind(l),l._animator=new to,l._vr=null,t&&l.setImage({image:t,imageType:r.imageType,isVideo:n,cubemapConfig:r.cubemapConfig}),l}a(t,s);var e=t.prototype;return e.setYawPitchControl=function(t){this._yawPitchControl=t},e.getContent=function(){return this._image},e.setImage=function(t){var e=t.image,i=t.imageType,n=t.isVideo,n=void 0!==n&&n,t=t.cubemapConfig;this._imageIsReady=!1,this._isVideo=n,this._imageConfig=c({order:i===eo.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0},trim:0},t),this._setImageType(i),this._contentLoader&&this._contentLoader.destroy(),this._contentLoader=(new pr).on("ready",this._onContentLoad).on("error",this._onContentError),n?(this._image=function(t){if(t instanceof HTMLVideoElement)return t;var e=document.createElement("video");return e.setAttribute("crossorigin","anonymous"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),t instanceof Array?t.forEach(function(t){return Jr(e,t)}):Jr(e,t),0<e.querySelectorAll("source").length&&e.readyState<1&&e.load(),e}(e),this._contentLoader.check([this._image]),this._keepUpdate=!0):(this._image=1===(e=((e=e)instanceof Array?e:[e]).map(function(t){var e=t;return"string"==typeof t&&((e=new Image).crossOrigin="anonymous",e.src=t),e})).length?e[0]:e,this._contentLoader.check(Array.isArray(this._image)?this._image:[this._image]),this._keepUpdate=!1)},e.isImageLoaded=function(){return!!this._image&&this._imageIsReady&&(!this._isVideo||2<=this._image.readyState)},e.bindTexture=function(){var n=this;return new u(function(e,i){var t=n._contentLoader;return n._image?t?void(t.isReady()?(n._bindTexture(),e()):(t.check(Array.isArray(n._image)?n._image:[n._image]),t.once("ready",function(t){0<t.errorCount?i("Failed to load images."):(n._bindTexture(),e())}))):i("ImageLoader is not initialized"):i("Image is not defined")})},e.attachTo=function(t){this.detach(),t.appendChild(this.canvas),this._wrapper=t},e.forceContextLoss=function(){var t;!this.hasRenderingContext()||(t=this.context.getExtension("WEBGL_lose_context"))&&t.loseContext()},e.detach=function(){this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},e.destroy=function(){this._contentLoader&&this._contentLoader.destroy(),this._animator.stop(),this.detach(),this.forceContextLoss(),this.off(),this.canvas.removeEventListener("webglcontextlost",this._onWebglcontextlost),this.canvas.removeEventListener("webglcontextrestored",this._onWebglcontextrestored)},e.hasRenderingContext=function(){var t=this.context;return!(!t||t.isContextLost()||!t.getProgramParameter(this.shaderProgram,t.LINK_STATUS))},e.updateFieldOfView=function(t){this.fieldOfView=t,this._updateViewport()},e.updateViewportDimensions=function(t,e){var i=!1;this.width=t,this.height=e;t*=io,e*=io;t!==this.canvas.width&&(this.canvas.width=t,i=!0),e!==this.canvas.height&&(this.canvas.height=e,i=!0),i&&(this._updateViewport(),this._shouldForceDraw=!0)},e.keepUpdate=function(t){t&&!1===this.isImageLoaded()&&(this._shouldForceDraw=!0),this._keepUpdate=t},e.startRender=function(){this._animator.setCallback(this._render.bind(this)),this._animator.start()},e.stopRender=function(){this._animator.stop()},e.renderWithQuaternion=function(t,e){var i,n,r,o,s,a,h,u,c,l;this.isImageLoaded()&&(!1===this._keepUpdate&&this._lastQuaternion&&Zi(this._lastQuaternion,t)&&this.fieldOfView&&this.fieldOfView===e&&!1===this._shouldForceDraw||(void 0!==e&&e!==this.fieldOfView&&this.updateFieldOfView(e),this.mvMatrix=(i=wi(),r=(n=t)[0],o=n[1],s=n[2],a=n[3],h=r*(c=r+r),u=o*c,n=o*(l=o+o),r=s*c,o=s*l,s*=e=s+s,c*=a,l*=a,e*=a,i[0]=1-n-s,i[1]=u+e,i[2]=r-l,i[3]=0,i[4]=u-e,i[5]=1-h-s,i[6]=o+c,i[7]=0,i[8]=r+l,i[9]=o-c,i[10]=1-h-n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i),this._draw(),this._lastQuaternion=ji(t),this._shouldForceDraw&&(this._shouldForceDraw=!1)))},e.renderWithYawPitch=function(t,e,i){this.isImageLoaded()&&(!1===this._keepUpdate&&null!==this._lastYaw&&this._lastYaw===t&&null!==this._lastPitch&&this._lastPitch===e&&this.fieldOfView&&this.fieldOfView===i&&!1===this._shouldForceDraw||(void 0!==i&&i!==this.fieldOfView&&this.updateFieldOfView(i),(i=this.mvMatrix)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,Ei(this.mvMatrix,this.mvMatrix,-e*vi),Ti(this.mvMatrix,this.mvMatrix,-t*vi),this._draw(),this._lastYaw=t,this._lastPitch=e,this._shouldForceDraw&&(this._shouldForceDraw=!1)))},e.getProjectionRenderer=function(){return this._renderer},e.enterVR=function(t){var e=this._vr;return j||navigator.getVRDisplays?e&&e.isPresenting()?u.resolve("VR already enabled."):this._requestPresent(t):u.reject("VR is not available on this browser.")},e._setImageType=function(t){var e=this;if(t&&this._imageType!==t){switch(this._imageType=t,this._isCubeMap=t===eo.CUBEMAP,this._renderer&&this._renderer.off(),t){case eo.CUBEMAP:this._renderer=new wr;break;case eo.CUBESTRIP:this._renderer=new Er;break;case eo.PANORAMA:this._renderer=new Yr;break;case eo.STEREOSCOPIC_EQUI:this._renderer=new Qr(this.sphericalConfig.stereoFormat);break;default:this._renderer=new Qr(Cr.NONE)}this._renderer.on(xr.EVENTS.ERROR,function(t){e.trigger(no.ERROR,{type:ro.RENDERER_ERROR,message:t.message})}),this._initWebGL()}},e._initCanvas=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,this._onWebglcontextlost=this._onWebglcontextlost.bind(this),this._onWebglcontextrestored=this._onWebglcontextrestored.bind(this),i.addEventListener("webglcontextlost",this._onWebglcontextlost),i.addEventListener("webglcontextrestored",this._onWebglcontextrestored),i},e._setDefaultCanvasStyle=function(){var t=this.canvas;t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.top="0",t.style.margin="auto",t.style.maxHeight="100%",t.style.maxWidth="100%",t.style.outline="none",t.style.position="absolute"},e._onContentError=function(t){return this._imageIsReady=!1,this._image=null,this.trigger(no.ERROR,{type:ro.FAIL_IMAGE_LOAD,message:"failed to load image"}),!1},e._triggerContentLoad=function(){this.trigger(no.IMAGE_LOADED,{content:this._image,isVideo:this._isVideo,projectionType:this._imageType})},e._onContentLoad=function(t){0<t.errorCount||(this._imageIsReady=!0,this._triggerContentLoad())},e._initShaderProgram=function(){var t=this.context;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null);var e=this._renderer,i=e.getVertexShaderSource(),e=e.getFragmentShaderSource(),i=gr.createShader(t,t.VERTEX_SHADER,i),e=gr.createShader(t,t.FRAGMENT_SHADER,e),e=gr.createProgram(t,i,e);if(!e)throw new Error("Failed to initialize shaders: "+gr.getErrorNameFromWebGLErrorCode(t.getError()));t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.pMatrixUniform=t.getUniformLocation(e,"uPMatrix"),e.mvMatrixUniform=t.getUniformLocation(e,"uMVMatrix"),e.samplerUniform=t.getUniformLocation(e,"uSampler"),e.textureCoordAttribute=t.getAttribLocation(e,"aTextureCoord"),e.uEye=t.getUniformLocation(e,"uEye"),t.enableVertexAttribArray(e.vertexPositionAttribute),t.enableVertexAttribArray(e.textureCoordAttribute),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.uniform1i(e.samplerUniform,0),this.shaderProgram=e},e._onWebglcontextlost=function(t){t.preventDefault(),this.trigger(no.RENDERING_CONTEXT_LOST)},e._onWebglcontextrestored=function(t){this._initWebGL(),this.trigger(no.RENDERING_CONTEXT_RESTORE)},e._updateViewport=function(){Ri(this.pMatrix,gi(this.fieldOfView),this.canvas.width/this.canvas.height,.1,100),this.context.viewport(0,0,this.context.drawingBufferWidth,this.context.drawingBufferHeight)},e._initWebGL=function(){var t;try{this._initRenderingContext(),t=this.context,this.updateViewportDimensions(this.width,this.height),this._initShaderProgram()}catch(t){return this.trigger(no.ERROR,{type:ro.NO_WEBGL,message:"no webgl support"}),this.destroy(),void console.error(t)}t.clearColor(0,0,0,0);var e=this._isCubeMap?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;this.texture&&t.deleteTexture(this.texture),this.texture=gr.createTexture(t,e),this._imageType===eo.CUBESTRIP&&t.enable(t.CULL_FACE)},e._initRenderingContext=function(){if(!this.hasRenderingContext()){if(!window.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");if(this.context=gr.getWebglContext(this.canvas,this._renderingContextAttributes),!this.context)throw new Error("Failed to acquire 3D rendering context")}},e._initBuffers=function(){var t=this._image,e=this._renderer.getVertexPositionData(),i=this._renderer.getIndexData(),n=this._renderer.getTextureCoordData({image:t,imageConfig:this._imageConfig}),t=this.context;this.vertexBuffer=gr.initBuffer(t,t.ARRAY_BUFFER,new Float32Array(e),3,this.shaderProgram.vertexPositionAttribute),this.indexBuffer=gr.initBuffer(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),1),this.textureCoordBuffer=gr.initBuffer(t,t.ARRAY_BUFFER,new Float32Array(n),this._isCubeMap?3:2,this.shaderProgram.textureCoordAttribute),this._bindBuffers()},e._bindTexture=function(){var t,e,i;this._imageType===eo.CUBESTRIP?(e=(t=this._renderer.getDimension(this._image)).width,i=t.height,t=e&&i&&e/i!=1.5?1:0,this.context.uniform1f(this.context.getUniformLocation(this.shaderProgram,"uIsEAC"),t)):this._imageType===eo.PANORAMA&&(e=(t=this._renderer.getDimension(this._image)).width,i=t.height,i=e&&i&&e/i,this._renderer.updateShaderData({imageAspectRatio:i})),this._initBuffers(),this._renderer.bindTexture(this.context,this.texture,this._image,this._imageConfig),this._shouldForceDraw=!0,this.trigger(no.BIND_TEXTURE)},e._updateTexture=function(){this._renderer.updateTexture(this.context,this._image,this._imageConfig)},e._render=function(){var t,e=this._yawPitchControl,i=e.getFov();e.shouldRenderWithQuaternion()?(t=e.getQuaternion(),this.renderWithQuaternion(t,i)):(e=e.getYawPitch(),this.renderWithYawPitch(e.yaw,e.pitch,i))},e._bindBuffers=function(){var t=this.context,e=this.shaderProgram,i=this.vertexBuffer,n=this.textureCoordBuffer;t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(e.vertexPositionAttribute),t.vertexAttribPointer(e.vertexPositionAttribute,i.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(e.textureCoordAttribute),t.vertexAttribPointer(e.textureCoordAttribute,n.itemSize,t.FLOAT,!1,0,0)},e._draw=function(){this._isVideo&&this._keepUpdate&&this._updateTexture(),this._renderer.render({gl:this.context,shaderProgram:this.shaderProgram,indexBuffer:this.indexBuffer,mvMatrix:this.mvMatrix,pMatrix:this.pMatrix})},e._requestPresent=function(t){var i=this,n=this.context,r=this.canvas,o=this._animator;this._vr=j?new $r(t):new Zr;var s=this._vr;return o.stop(),new u(function(t,e){s.requestPresent(r,n).then(function(){s.addEndCallback(i.exitVR),o.setContext(s.context),o.setCallback(i._onFirstVRFrame),k&&i._setWrapperFullscreen(),i._shouldForceDraw=!0,o.start(),t("success")}).catch(function(t){s.destroy(),i._vr=null,o.start(),e(t)})})},e._setWrapperFullscreen=function(){var t=this._wrapper;t&&(this._wrapperOrigStyle=t.getAttribute("style"),(t=t.style).width="100vw",t.height="100vh",t.position="fixed",t.left="0",t.top="0",t.zIndex="9999")},e._restoreStyle=function(){var t=this._wrapper,e=this.canvas;t&&(this._wrapperOrigStyle?t.setAttribute("style",this._wrapperOrigStyle):t.removeAttribute("style"),this._wrapperOrigStyle=null,e.removeAttribute("style"),this._setDefaultCanvasStyle())},t.EVENTS=no,t.ERROR_TYPE=ro,t}(t),B=function(o){function s(t,e){void 0===e&&(e={});var i=o.call(this)||this;if(!gr.isWebGLAvailable())return setTimeout(function(){i.trigger(Rr.ERROR,{type:Tr.NO_WEBGL,message:"no webgl support"})},0),i;if(!gr.isStableWebGL())return setTimeout(function(){i.trigger(Rr.ERROR,{type:Tr.INVALID_DEVICE,message:"blacklisted browser"})},0),i;if(e.image&&e.video)return setTimeout(function(){i.trigger(Rr.ERROR,{type:Tr.INVALID_RESOURCE,message:"Specifying multi resouces(both image and video) is not valid."})},0),i;H(),i._container=t,i._image=e.image||e.video,i._isVideo=!!e.video,i._projectionType=e.projectionType||br.EQUIRECTANGULAR,i._cubemapConfig=c({order:i._projectionType===br.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0},trim:0},e.cubemapConfig),i._stereoFormat=e.stereoFormat||Cr.TOP_BOTTOM,i._width=e.width||parseInt(window.getComputedStyle(t).width,10),i._height=e.height||parseInt(window.getComputedStyle(t).height,10),i._yaw=e.yaw||0,i._pitch=e.pitch||0,i._fov=e.fov||65,i._gyroMode=e.gyroMode||An.YAWPITCH,i._quaternion=null,i._aspectRatio=0!==i._height?i._width/i._height:1;var n=e.fovRange||[30,110],r=s._isValidTouchDirection(e.touchDirection)?e.touchDirection:Yn.TOUCH_DIRECTION_ALL,r=c(c({},e),{element:t,yaw:i._yaw,pitch:i._pitch,fov:i._fov,gyroMode:i._gyroMode,fovRange:n,aspectRatio:i._aspectRatio,touchDirection:r});return i._isReady=!1,i._initYawPitchControl(r),i._initRenderer(i._yaw,i._pitch,i._fov,i._projectionType,i._cubemapConfig),i}a(s,o);var t=s.prototype;return s.isSupported=function(){return gr.isWebGLAvailable()&&gr.isStableWebGL()},s.isWebGLAvailable=function(){return gr.isWebGLAvailable()},s.isGyroSensorAvailable=function(t){var i;W||!t?u.race([new u(function(e,t){i=function(t){t=!(null==t.rotationRate.alpha);e(t)},window.addEventListener("devicemotion",i)}),new u(function(t,e){setTimeout(function(){return t(!1)},1e3)})]).then(function(e){window.removeEventListener("devicemotion",i),t&&t(e),s.isGyroSensorAvailable=function(t){return t&&t(e),e}}):t(!1)},s._isValidTouchDirection=function(t){return t===s.TOUCH_DIRECTION.NONE||t===s.TOUCH_DIRECTION.YAW||t===s.TOUCH_DIRECTION.PITCH||t===s.TOUCH_DIRECTION.ALL},t.getVideo=function(){return this._isVideo?this._photoSphereRenderer.getContent():null},t.setVideo=function(t,e){return void 0===e&&(e={}),t&&this.setImage(t,{projectionType:e.projectionType,isVideo:!0,cubemapConfig:e.cubemapConfig,stereoFormat:e.stereoFormat}),this},t.getImage=function(){return this._isVideo?null:this._photoSphereRenderer.getContent()},t.setImage=function(t,e){void 0===e&&(e={});var i=c({order:"RLUDBF",tileConfig:{flipHorizontal:!1,rotation:0},trim:0},e.cubemapConfig),n=e.stereoFormat||Cr.TOP_BOTTOM,r=!!e.isVideo;return this._image&&this._isVideo!==r?console.warn("PanoViewer is not currently supporting content type changes. (Image <--\x3e Video)"):t&&(this._image=t,this._isVideo=r,this._projectionType=e.projectionType||br.EQUIRECTANGULAR,this._cubemapConfig=i,this._stereoFormat=n,this._deactivate(),this._initRenderer(this._yaw,this._pitch,this._fov,this._projectionType,this._cubemapConfig)),this},t.keepUpdate=function(t){return this._photoSphereRenderer.keepUpdate(t),this},t.getProjectionType=function(){return this._projectionType},t.enableSensor=function(){return new u(function(e,i){W&&"function"==typeof W.requestPermission?W.requestPermission().then(function(t){"granted"===t?e():i(new Error("permission denied"))}).catch(function(t){i(t)}):e()})},t.disableSensor=function(){return this},t.enterVR=function(t){var n=this;return void 0===t&&(t={}),this._isReady?new u(function(e,i){n.enableSensor().then(function(){return n._photoSphereRenderer.enterVR(t)}).then(function(t){return e(t)}).catch(function(t){return i(t)})}):u.reject(new Error("PanoViewer is not ready to show image."))},t.exitVR=function(){return this._photoSphereRenderer.exitVR(),this},t.setUseZoom=function(t){return"boolean"==typeof t&&this._yawPitchControl.option("useZoom",t),this},t.setUseKeyboard=function(t){return this._yawPitchControl.option("useKeyboard",t),this},t.setGyroMode=function(t){return this._yawPitchControl.option("gyroMode",t),this},t.setFovRange=function(t){return this._yawPitchControl.option("fovRange",t),this},t.getFovRange=function(){return this._yawPitchControl.option("fovRange")},t.updateViewportDimensions=function(t){if(void 0===t&&(t={}),!this._isReady)return this;void 0!==t.width&&void 0!==t.height||(i=window.getComputedStyle(this._container));var e=t.width||parseInt(i.width,10),i=t.height||parseInt(i.height,10);return e===this._width&&i===this._height||(this._width=e,this._height=i,this._aspectRatio=e/i,this._photoSphereRenderer.updateViewportDimensions(e,i),this._yawPitchControl.option("aspectRatio",this._aspectRatio),this._yawPitchControl.updatePanScale({height:i}),this.lookAt({},0)),this},t.getFov=function(){return this._fov},t.getYaw=function(){return this._yaw},t.getPitch=function(){return this._pitch},t.getYawRange=function(){return this._yawPitchControl.option("yawRange")},t.getPitchRange=function(){return this._yawPitchControl.option("pitchRange")},t.setYawRange=function(t){return this._yawPitchControl.option("yawRange",t),this},t.setPitchRange=function(t){return this._yawPitchControl.option("pitchRange",t),this},t.setShowPolePoint=function(t){return this._yawPitchControl.option("showPolePoint",t),this},t.lookAt=function(t,e){if(void 0===e&&(e=0),!this._isReady)return this;var i=void 0!==t.yaw?t.yaw:this._yaw,n=void 0!==t.pitch?t.pitch:this._pitch,r=this._yawPitchControl.option("pitchRange"),r=r[1]-r[0],t=void 0!==t.fov?t.fov:this._fov;return r<t&&(t=r),this._yawPitchControl.lookAt({yaw:i,pitch:n,fov:t},e),0===e&&this._photoSphereRenderer.renderWithYawPitch(i,n,t),this},t.setTouchDirection=function(t){return s._isValidTouchDirection(t)&&this._yawPitchControl.option("touchDirection",t),this},t.getTouchDirection=function(){return this._yawPitchControl.option("touchDirection")},t.destroy=function(){return this._deactivate(),this._yawPitchControl&&(this._yawPitchControl.destroy(),this._yawPitchControl=null),this},t._initRenderer=function(t,e,i,n,r){var o=this;this._photoSphereRenderer=new oo(this._image,this._width,this._height,this._isVideo,{initialYaw:t,initialPitch:e,fieldOfView:i,imageType:n,cubemapConfig:r,stereoFormat:this._stereoFormat}),this._photoSphereRenderer.setYawPitchControl(this._yawPitchControl),this._bindRendererHandler(),this._photoSphereRenderer.bindTexture().then(function(){return o._activate()}).catch(function(){o.trigger(Rr.ERROR,{type:Tr.FAIL_BIND_TEXTURE,message:"failed to bind texture"})})},t._updateYawPitchIfNeeded=function(){var t,e,i;this._projectionType===s.ProjectionType.PANORAMA&&(e=t=void 0,(i=(i=this._photoSphereRenderer.getContent()).naturalWidth/i.naturalHeight)<1&&(i=1/i),e=i<6?(t=sn.toDegree(i),2*sn.toDegree(Math.atan(.5))):(t=360)/i,i=this._yawPitchControl.option("fovRange")[0],this._yawPitchControl.option({fov:e,yawRange:[-t/2,t/2],pitchRange:[-e/2,e/2],fovRange:[i,e]}),this.lookAt({fov:e}))},t._bindRendererHandler=function(){var e=this;this._photoSphereRenderer.on(oo.EVENTS.ERROR,function(t){e.trigger(Rr.ERROR,t)}),this._photoSphereRenderer.on(oo.EVENTS.RENDERING_CONTEXT_LOST,function(t){e._deactivate(),e.trigger(Rr.ERROR,{type:Tr.RENDERING_CONTEXT_LOST,message:"webgl rendering context lost"})})},t._initYawPitchControl=function(t){var e=this;this._yawPitchControl=new Yn(t),this._yawPitchControl.on(Rr.ANIMATION_END,function(t){e.trigger(Rr.ANIMATION_END,t)}),this._yawPitchControl.on("change",function(t){e._yaw=t.yaw,e._pitch=t.pitch,e._fov=t.fov,e._quaternion=t.quaternion,e.trigger(Rr.VIEW_CHANGE,t)})},t._activate=function(){this._photoSphereRenderer.attachTo(this._container),this._yawPitchControl.enable(),this.updateViewportDimensions(),this._isReady=!0,this._updateYawPitchIfNeeded(),this.trigger(Rr.READY),this._photoSphereRenderer.startRender()},t._deactivate=function(){this._isReady&&(this._photoSphereRenderer.stopRender(),this._yawPitchControl.disable(),this._isReady=!1),this._photoSphereRenderer&&(this._photoSphereRenderer.destroy(),this._photoSphereRenderer=null)},s.VERSION=Qn,s.ERROR_TYPE=Tr,s.EVENTS=Rr,s.PROJECTION_TYPE=br,s.GYRO_MODE=An,s.ProjectionType=br,s.STEREO_FORMAT=Cr,s.TOUCH_DIRECTION={NONE:Yn.TOUCH_DIRECTION_NONE,YAW:Yn.TOUCH_DIRECTION_YAW,PITCH:Yn.TOUCH_DIRECTION_PITCH,ALL:Yn.TOUCH_DIRECTION_ALL},s}(t),so=function(r){function o(t,e){void 0===e&&(e={});var i=r.call(this)||this,n=e||{};return i._el=t,i._rowCount=n.rowCount||1,i._colCount=n.colCount||1,i._totalCount=i._rowCount*i._colCount,i._width=n.width||"auto",i._height=n.height||"auto",i._autoHeight=null==n.autoHeight||n.autoHeight,i._colRow=[0,0],n.colRow?i._colRow=n.colRow:n.frameIndex&&i.setFrameIndex(n.frameIndex),i._el.style.width=o._getSizeString(i._width),i._el.style.height=o._getSizeString(i._height),n.imageUrl?(i._image=new Image,i._image.onload=function(){i._bg=o._createBgDiv(i._image,i._rowCount,i._colCount,i._autoHeight),i._el.appendChild(i._bg),i.setColRow(i._colRow[0],i._colRow[1]),i.trigger("load",{target:i._el,bgElement:i._bg}),i._autoPlayReservedInfo&&(i.play(i._autoPlayReservedInfo),i._autoPlayReservedInfo=null)},i._image.onerror=function(t){i.trigger("imageError",{imageUrl:n.imageUrl})},i._image.src=n.imageUrl):setTimeout(function(){i.trigger("imageError",{imageUrl:n.imageUrl})},0),i}a(o,r);var t=o.prototype;return o._createBgDiv=function(t,e,i,n){var r=document.createElement("div");r.style.position="relative",r.style.overflow="hidden",t.style.position="absolute",t.style.width=100*i+"%",t.style.height=100*e+"%",t.ondragstart=function(){return!1},G&&(t.style.willChange="transform"),r.appendChild(t);i=t.width/i,e=t.height/e;return n?(i=e/i,r.style.paddingBottom=100*i+"%"):r.style.height="100%",r},o._getSizeString=function(t){return"number"==typeof t?t+"px":t},t.setFrameIndex=function(t){t=this.toColRow(t);this.setColRow(t[0],t[1])},t.getFrameIndex=function(){return this._colRow[1]*this._colCount+this._colRow[0]},t.setColRow=function(t,e){e>this._rowCount-1||t>this._colCount-1||(this._image&&Y&&(this._image.style[Y]="translate("+-(t/this._colCount)*100+"%, "+-(e/this._rowCount)*100+"%)"),this._colRow=[t,e])},t.getColRow=function(){return this._colRow},t.stop=function(){this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=-1)},t.play=function(t){var e,i,n,r=this,o=void 0===t?{interval:1e3/this._totalCount,playCount:0}:t,t=o.interval,s=o.playCount;this._bg?(this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=-1),e=this.getFrameIndex(),n=i=0,this._autoPlayTimer=window.setInterval(function(){e%=r._totalCount;var t=r.toColRow(e);r.setColRow(t[0],t[1]),e++,++n===r._totalCount&&(n=0,i++),0<s&&i===s&&clearInterval(r._autoPlayTimer)},t)):this._autoPlayReservedInfo={interval:t,playCount:s}},t.toColRow=function(t){var e=this._colCount,i=this._rowCount;return t<0?[0,0]:t>=this._totalCount?[e-1,i-1]:[t%e,Math.floor(t/e)]},o.VERSION=Qn,o}(t);return{PanoViewer:B,SpinViewer:function(o){function t(t,e){void 0===e&&(e={});var i=o.call(this)||this;i._el=t;var n=c({},e),r=n.colCount||1,e=n.rowCount||1;return i._scale=n.scale||1,i._panScale=.21*i._scale,i._frameCount=r*e,i._sprites=new so(t,n).on({load:function(t){i.trigger("load",t)},imageError:function(t){i.trigger("imageError",{imageUrl:t.imageUrl})}}),i._panInput=new ci(i._el,{scale:[i._panScale,i._panScale]}),i._axes=new ii({angle:{range:[0,359],circular:!0}}).on({change:function(t){var e=Math.floor(t.pos.angle/(360/i._frameCount)),e=i._frameCount-e-1;i._sprites.setFrameIndex(e),i.trigger("change",{frameIndex:e,colRow:i._sprites.getColRow(),angle:t.pos.angle})},animationEnd:function(t){i.trigger("animationEnd",{isTrusted:t.isTrusted})}}),i._axes.connect("angle",i._panInput),i}a(t,o);var e=t.prototype;return e.setScale=function(t){return isNaN(t)||t<0||(this._scale=t,this._panScale=.21*t,this._panInput.options.scale=[this._panScale,this._panScale]),this},e.getScale=function(){return this._scale},e.spinBy=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setBy({angle:t},e.duration),this},e.spinTo=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setTo({angle:t},e.duration),this},e.getAngle=function(){return this._axes.get().angle||0},t.VERSION=Qn,t}(t),SpriteImage:so,VERSION:Qn}});
//# sourceMappingURL=view360.pkgd.min.js.map
